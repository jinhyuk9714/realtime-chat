# ì‹¤ì‹œê°„ ì±„íŒ… ì„œë¹„ìŠ¤ â€” ì™•ì´ˆë³´ í•™ìŠµ ê°€ì´ë“œ

> ì´ ë¬¸ì„œëŠ” **í”„ë¡œê·¸ë˜ë°ì„ ë§‰ ì‹œì‘í•œ ì‚¬ëŒ**ë„ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
> ëª¨ë“  ê¸°ìˆ  ìš©ì–´ë¥¼ **ì¼ìƒìƒí™œ ë¹„ìœ **ë¡œ ë¨¼ì € ì„¤ëª…í•˜ê³ , ê·¸ ë‹¤ìŒì— ì½”ë“œë¥¼ ë´…ë‹ˆë‹¤.
> ê¸°ì¡´ `STUDY_GUIDE.md`ë³´ë‹¤ í›¨ì”¬ ì‰½ê³  ìì„¸í•©ë‹ˆë‹¤.

---

## ëª©ì°¨

### Part 1: ì´ê±° ë­ ë§Œë“œëŠ” ê±°ì•¼?
1. [ì¹´ì¹´ì˜¤í†¡ì„ ì§ì ‘ ë§Œë“ ë‹¤ê³ ?](#1-ì¹´ì¹´ì˜¤í†¡ì„-ì§ì ‘-ë§Œë“ ë‹¤ê³ )
2. [ì´ í”„ë¡œì íŠ¸ì—ì„œ ì“°ëŠ” ê¸°ìˆ ë“¤ â€” ì‰¬ìš´ ì„¤ëª…](#2-ì´-í”„ë¡œì íŠ¸ì—ì„œ-ì“°ëŠ”-ê¸°ìˆ ë“¤--ì‰¬ìš´-ì„¤ëª…)
3. [í´ë” êµ¬ì¡° â€” íšŒì‚¬ ì¡°ì§ë„ì²˜ëŸ¼ ì´í•´í•˜ê¸°](#3-í´ë”-êµ¬ì¡°--íšŒì‚¬-ì¡°ì§ë„ì²˜ëŸ¼-ì´í•´í•˜ê¸°)

### Part 2: 1ì°¨ êµ¬í˜„ (MVP) â€” ì¼ë‹¨ ë™ì‘í•˜ê²Œ ë§Œë“¤ê¸°
4. [STEP 1: í”„ë¡œì íŠ¸ ë¼ˆëŒ€ â€” ì§‘ ì§“ê¸° ì „ ì„¤ê³„ë„](#4-step-1-í”„ë¡œì íŠ¸-ë¼ˆëŒ€)
5. [STEP 2: ë°ì´í„°ë² ì´ìŠ¤ â€” ë°ì´í„°ë¥¼ ì–´ë””ì— ì €ì¥í•˜ì§€?](#5-step-2-ë°ì´í„°ë² ì´ìŠ¤)
6. [STEP 3: ë¡œê·¸ì¸ â€” ë„ˆ ëˆ„êµ¬ì•¼?](#6-step-3-ë¡œê·¸ì¸)
7. [STEP 4: ì±„íŒ…ë°© â€” ëŒ€í™”í•  ê³µê°„ ë§Œë“¤ê¸°](#7-step-4-ì±„íŒ…ë°©)
8. [STEP 5: Kafka â€” ìš°ì²´êµ­ ì‹œìŠ¤í…œ](#8-step-5-kafka)
9. [STEP 6: WebSocket + Redis â€” ì‹¤ì‹œê°„ ë°°ë‹¬](#9-step-6-websocket--redis)
10. [STEP 7: ë©”ì‹œì§€ ì´ë ¥ + ì½ìŒ í‘œì‹œ](#10-step-7-ë©”ì‹œì§€-ì´ë ¥--ì½ìŒ-í‘œì‹œ)
11. [STEP 8: í…ŒìŠ¤íŠ¸ â€” ì§„ì§œ ì˜ ë˜ëŠ”ì§€ í™•ì¸](#11-step-8-í…ŒìŠ¤íŠ¸)
12. [ë©”ì‹œì§€ ì—¬í–‰ê¸° â€” "ì•ˆë…•"ì´ ì „ë‹¬ë˜ê¸°ê¹Œì§€](#12-ë©”ì‹œì§€-ì—¬í–‰ê¸°)

### Part 3: 2ì°¨ êµ¬í˜„ (í”„ë¡œë•ì…˜ í’ˆì§ˆ) â€” ì§„ì§œ ì„œë¹„ìŠ¤ì²˜ëŸ¼ ë§Œë“¤ê¸°
13. [STEP 9: ê±´ê°• ê²€ì§„ + ìš°ì•„í•œ í‡´ì¥](#13-step-9-ê±´ê°•-ê²€ì§„--ìš°ì•„í•œ-í‡´ì¥)
14. [STEP 10: ë„ë°° ë°©ì§€](#14-step-10-ë„ë°°-ë°©ì§€)
15. [STEP 11: ì‹¤íŒ¨í•œ ë©”ì‹œì§€ êµ¬ì¡°ëŒ€](#15-step-11-ì‹¤íŒ¨í•œ-ë©”ì‹œì§€-êµ¬ì¡°ëŒ€)
16. [STEP 12: ì ‘ì† ì¤‘ í‘œì‹œ](#16-step-12-ì ‘ì†-ì¤‘-í‘œì‹œ)
17. [STEP 13: ì„œë²„ ì—¬ëŸ¬ ëŒ€ë¡œ ëŠ˜ë¦¬ê¸°](#17-step-13-ì„œë²„-ì—¬ëŸ¬-ëŒ€ë¡œ-ëŠ˜ë¦¬ê¸°)

### Part 4: 3ì°¨ êµ¬í˜„ (ëª¨ë‹ˆí„°ë§ + ì„±ëŠ¥ ìµœì í™”) â€” ë” ë¹ ë¥´ê³  ë˜‘ë˜‘í•˜ê²Œ
18. [STEP 14: ê±´ê°• ìƒíƒœíŒ ë§Œë“¤ê¸° (Prometheus + Grafana)](#18-step-14-ê±´ê°•-ìƒíƒœíŒ-ë§Œë“¤ê¸°)
19. [STEP 15~16: ëŠë¦° ì¿¼ë¦¬ ê³ ì¹˜ê¸° + ìºì‹œ](#19-step-1516-ëŠë¦°-ì¿¼ë¦¬-ê³ ì¹˜ê¸°--ìºì‹œ)
20. [STEP 17: DB ì¸ë±ìŠ¤ â€” ì±…ì˜ ëª©ì°¨ ë§Œë“¤ê¸°](#20-step-17-db-ì¸ë±ìŠ¤)
21. [STEP 18~19: ë¶€í•˜ í…ŒìŠ¤íŠ¸ â€” ì§„ì§œ ë¹ ë¥¸ì§€ ì¦ëª…í•˜ê¸°](#21-step-1819-ë¶€í•˜-í…ŒìŠ¤íŠ¸)

### Part 5: ê¶ê¸ˆí•  ìˆ˜ ìˆëŠ” ê²ƒë“¤
22. [ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ (ì§„ì§œ ì‰¬ìš´ ë²„ì „)](#22-ìì£¼-ë¬»ëŠ”-ì§ˆë¬¸)

---

# Part 1: ì´ê±° ë­ ë§Œë“œëŠ” ê±°ì•¼?

---

## 1. ì¹´ì¹´ì˜¤í†¡ì„ ì§ì ‘ ë§Œë“ ë‹¤ê³ ?

### í•œ ì¤„ ìš”ì•½

> **ì¹´ì¹´ì˜¤í†¡ì˜ "ì±„íŒ…" ê¸°ëŠ¥**ì„ ë°±ì—”ë“œ(ì„œë²„ ìª½)ì—ì„œ ì§ì ‘ ë§Œë“œëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

### ì¹´ì¹´ì˜¤í†¡ì—ì„œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´ ë¬´ìŠ¨ ì¼ì´ ë²Œì–´ì§ˆê¹Œ?

ì—¬ëŸ¬ë¶„ì´ ì¹´ì¹´ì˜¤í†¡ì—ì„œ ì¹œêµ¬ì—ê²Œ "ì•ˆë…•"ì´ë¼ê³  ë³´ë‚´ë©´, ì‹¤ì œë¡œëŠ” ì´ëŸ° ì¼ì´ ë²Œì–´ì§‘ë‹ˆë‹¤:

```
1. ì—¬ëŸ¬ë¶„ í°ì˜ ì¹´ì¹´ì˜¤í†¡ ì•±ì´ "ì•ˆë…•"ì„ ì„œë²„ì— ì „ì†¡
2. ì„œë²„ê°€ "ì•ˆë…•"ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ (ë‚˜ì¤‘ì— ë‹¤ì‹œ ë³¼ ìˆ˜ ìˆë„ë¡)
3. ì„œë²„ê°€ ì¹œêµ¬ì˜ í°ìœ¼ë¡œ "ì•ˆë…•"ì„ ì¦‰ì‹œ ì „ë‹¬
4. ì¹œêµ¬ í°ì—ì„œ "ì•ˆë…•"ì´ í™”ë©´ì— ë‚˜íƒ€ë‚¨
```

**ì´ í”„ë¡œì íŠ¸ëŠ” 2~3ë²ˆ, ì¦‰ "ì„œë²„ê°€ í•˜ëŠ” ì¼"ì„ ë§Œë“­ë‹ˆë‹¤.**

### ê·¸ëŸ°ë° ì™œ ì´ë ‡ê²Œ ë³µì¡í•´?

ì¹´ì¹´ì˜¤í†¡ ì‚¬ìš©ìê°€ 1ëª…ì´ë©´ ê°„ë‹¨í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ **5,000ë§Œ ëª…**ì´ ë™ì‹œì— ì“´ë‹¤ë©´?

```
[ê°„ë‹¨í•œ ë²„ì „ â€” ì„œë²„ 1ëŒ€]

ì‚¬ìš©ì A â”€â”€ë©”ì‹œì§€â”€â”€â†’ [ì„œë²„ 1ëŒ€] â”€â”€ì „ë‹¬â”€â”€â†’ ì‚¬ìš©ì B

ë¬¸ì œì—†ì–´ ë³´ì´ì£ ? ê·¸ëŸ°ë°...

Q: ì„œë²„ 1ëŒ€ê°€ 5,000ë§Œ ëª…ì„ ê°ë‹¹í•  ìˆ˜ ìˆì„ê¹Œ?
A: ë¶ˆê°€ëŠ¥! ì„œë²„ë¥¼ ì—¬ëŸ¬ ëŒ€ë¡œ ëŠ˜ë ¤ì•¼ í•©ë‹ˆë‹¤.
```

```
[í˜„ì‹¤ ë²„ì „ â€” ì„œë²„ ì—¬ëŸ¬ ëŒ€]

ì‚¬ìš©ì A â”€â†’ [ì„œë²„ 1] â”€â†’ ???
ì‚¬ìš©ì B â”€â†’ [ì„œë²„ 2] â”€â†’ ???

ë¬¸ì œ: Aê°€ ì„œë²„1ì—, Bê°€ ì„œë²„2ì— ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´
ì„œë²„1ì´ Bì—ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ê°€ ì—†ìŒ!

í•´ê²°: "ì¤‘ê°„ ì „ë‹¬ì"ê°€ í•„ìš”
â†’ Kafka: ë©”ì‹œì§€ë¥¼ ì•ˆì „í•˜ê²Œ ë³´ê´€í•˜ëŠ” ìš°ì²´êµ­
â†’ Redis: ëª¨ë“  ì„œë²„ì— ì†Œì‹ì„ ì „í•˜ëŠ” ë°©ì†¡êµ­
â†’ WebSocket: ì‚¬ìš©ìì—ê²Œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°°ë‹¬í•˜ëŠ” ë°°ë‹¬ì›
```

ì´ê²Œ ì´ í”„ë¡œì íŠ¸ì˜ ì „ë¶€ì…ë‹ˆë‹¤. **ì„œë²„ê°€ ì—¬ëŸ¬ ëŒ€ì—¬ë„ ë©”ì‹œì§€ê°€ ì•ˆì „í•˜ê³  ë¹ ë¥´ê²Œ ì „ë‹¬ë˜ë„ë¡** ë§Œë“œëŠ” ê²ƒ!

### ì „ì²´ ê·¸ë¦¼ â€” íƒë°° ë°°ì†¡ìœ¼ë¡œ ì´í•´í•˜ê¸°

```
[í˜„ì‹¤ ì„¸ê³„ íƒë°°]
ë³´ë‚´ëŠ” ì‚¬ëŒ â†’ í¸ì˜ì  ì ‘ìˆ˜ â†’ ë¬¼ë¥˜ ì„¼í„° â†’ ë°°ë‹¬ ê¸°ì‚¬ â†’ ë°›ëŠ” ì‚¬ëŒ

[ìš°ë¦¬ í”„ë¡œì íŠ¸]
ì‚¬ìš©ì A â†’ Spring Boot â†’ Kafka(ë¬¼ë¥˜ì„¼í„°) â†’ Redis(ë°°ë‹¬ê¸°ì‚¬) â†’ ì‚¬ìš©ì B
             ì„œë²„          ì•ˆì „ ë³´ê´€         ëª¨ë“  ì„œë²„ì—      ì‹¤ì‹œê°„
           (í¸ì˜ì )        + ìˆœì„œ ë³´ì¥        ë¿Œë¦¼           ìˆ˜ì‹ 
```

```
ìƒì„¸ íë¦„:

[ì‚¬ìš©ì A] â”€â”€â”€ "ì•ˆë…•" â”€â”€â”€â†’ [Spring Boot ì„œë²„]
                                    â”‚
                              Kafkaì— ë³´ê´€
                              (ë¬¼ë¥˜ ì„¼í„°)
                                    â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â–¼                      â–¼
                   [ì§ì› 1]                [ì§ì› 2]
                  DBì— ì €ì¥              Redisë¡œ ë°©ì†¡
                (ì°½ê³ ì— ë³´ê´€)          (ëª¨ë“  ì§€ì ì— ì•Œë¦¼)
                                            â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                                    â–¼               â–¼
                              [ì„œë²„ 1]          [ì„œë²„ 2]
                              ë°©ì†¡ ìˆ˜ì‹           ë°©ì†¡ ìˆ˜ì‹ 
                                    â”‚               â”‚
                              WebSocket         WebSocket
                              (ë°°ë‹¬ì›)           (ë°°ë‹¬ì›)
                                    â”‚               â”‚
                              [ì‚¬ìš©ì B]        [ì‚¬ìš©ì C]
                              "ì•ˆë…•" ìˆ˜ì‹        "ì•ˆë…•" ìˆ˜ì‹ 
```

---

## 2. ì´ í”„ë¡œì íŠ¸ì—ì„œ ì“°ëŠ” ê¸°ìˆ ë“¤ â€” ì‰¬ìš´ ì„¤ëª…

### Spring Boot â€” "ê°€ê²Œë¥¼ ìë™ìœ¼ë¡œ ì°¨ë ¤ì£¼ëŠ” ë„êµ¬"

ì—¬ëŸ¬ë¶„ì´ ì¹´í˜ë¥¼ ì°¨ë¦°ë‹¤ê³  ìƒìƒí•´ë³´ì„¸ìš”.

```
[Spring Boot ì—†ì´]
1. ê±´ë¬¼ì„ ì§ì ‘ ì§€ìŒ
2. ì „ê¸°, ìˆ˜ë„ ì§ì ‘ ì—°ê²°
3. ì£¼ë°© ì„¤ë¹„ ì§ì ‘ ì„¤ì¹˜
4. ë©”ë‰´íŒ ì§ì ‘ ì œì‘
5. ê²°ì œ ì‹œìŠ¤í…œ ì§ì ‘ êµ¬ì¶•
â†’ ì»¤í”¼ í•œ ì” íŒ”ê¸°ê¹Œì§€ 6ê°œì›”

[Spring Boot ì‚¬ìš©]
1. "ì¹´í˜ í•˜ê³  ì‹¶ì–´ìš”" í•œë§ˆë””
2. ê±´ë¬¼, ì „ê¸°, ìˆ˜ë„, ì£¼ë°©, ë©”ë‰´íŒ ì „ë¶€ ìë™ ì„¸íŒ…
â†’ ë°”ë¡œ ì»¤í”¼ ë§Œë“¤ê¸° ì‹œì‘!
```

```java
// ì´ ì½”ë“œ 3ì¤„ì´ë©´ ì›¹ ì„œë²„ê°€ ì™„ì„±ë¨
@RestController
public class HelloController {
    @GetMapping("/hello")
    public String hello() { return "ì•ˆë…•í•˜ì„¸ìš”!"; }
}
// ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8080/hello ì ‘ì†í•˜ë©´ "ì•ˆë…•í•˜ì„¸ìš”!" í‘œì‹œ
```

### JPA â€” "í†µì—­ì‚¬"

ì—¬ëŸ¬ë¶„ì€ Javaë¡œ ë§í•˜ê³ , ë°ì´í„°ë² ì´ìŠ¤(DB)ëŠ” SQLì´ë¼ëŠ” ì–¸ì–´ë¥¼ ì”ë‹ˆë‹¤.
JPAëŠ” Javaì™€ DB ì‚¬ì´ì˜ **í†µì—­ì‚¬**ì…ë‹ˆë‹¤.

```
[JPA ì—†ì´ â€” ì§ì ‘ SQL ì‘ì„±]
String sql = "INSERT INTO users (email, password, nickname) VALUES ('a@b.com', '1234', 'í™ê¸¸ë™')";
connection.prepareStatement(sql).executeUpdate();

â†’ SQL ë¬¸ë²•ì„ ì™¸ì›Œì•¼ í•˜ê³ , ì˜¤íƒ€ ë‚˜ë©´ ì—ëŸ¬

[JPA ì‚¬ìš© â€” Java ì½”ë“œë¡œ DB ì¡°ì‘]
User user = new User("a@b.com", "1234", "í™ê¸¸ë™");
userRepository.save(user);   // â† ì´ í•œ ì¤„ì´ ìœ„ì˜ SQLì„ ëŒ€ì‹ í•¨!

â†’ Java ì½”ë“œë§Œ ì•Œë©´ ë¨, SQLì€ JPAê°€ ìë™ ìƒì„±
```

```
ë¹„ìœ : í•´ì™¸ ì‹ë‹¹

JPA ì—†ì´: ë©”ë‰´íŒì´ í”„ë‘ìŠ¤ì–´ â†’ í”„ë‘ìŠ¤ì–´ë¥¼ ë°°ì›Œì•¼ ì£¼ë¬¸ ê°€ëŠ¥
JPA ì‚¬ìš©: í•œêµ­ì–´ë¡œ "ìŠ¤í…Œì´í¬ ì£¼ì„¸ìš”" â†’ í†µì—­ì‚¬ê°€ í”„ë‘ìŠ¤ì–´ë¡œ ì „ë‹¬
```

### JWT â€” "ë†€ì´ê³µì› ì†ëª© ë°´ë“œ"

ë†€ì´ê³µì›ì— ê°€ë©´ ì…ì¥í•  ë•Œ ì†ëª© ë°´ë“œë¥¼ ë°›ì£ ? JWTê°€ ë°”ë¡œ ê·¸ê²ë‹ˆë‹¤.

```
[ë†€ì´ê³µì›]
1. ì…êµ¬ì—ì„œ ì‹ ë¶„ì¦ í™•ì¸ (ë¡œê·¸ì¸)
2. ì†ëª© ë°´ë“œ ë°œê¸‰ (JWT í† í°)
3. ì´í›„ ëª¨ë“  ë†€ì´ê¸°êµ¬ì—ì„œ ë°´ë“œë§Œ ë³´ì—¬ì£¼ë©´ ë¨ (ë§¤ë²ˆ ì‹ ë¶„ì¦ ì•ˆ êº¼ë‚´ë„ ë¨)
4. ë°´ë“œì— ì íŒ ì •ë³´: "ê¹€ì² ìˆ˜, VIP, ì˜¤ëŠ˜ê¹Œì§€ ìœ íš¨"

[ìš°ë¦¬ ì„œë¹„ìŠ¤]
1. ì´ë©”ì¼ + ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸
2. JWT í† í° ë°œê¸‰: "eyJhbGciOiJIUzI1NiJ9.eyJ..."
3. ì´í›„ ëª¨ë“  API í˜¸ì¶œ ì‹œ í† í°ë§Œ ì „ì†¡ (ë§¤ë²ˆ ë¡œê·¸ì¸ ì•ˆ í•´ë„ ë¨)
4. í† í°ì— ë‹´ê¸´ ì •ë³´: "userId=1, email=a@b.com, ë‚´ì¼ê¹Œì§€ ìœ íš¨"
```

```
JWT í† í° êµ¬ì¡° (ì‹¤ì œë¡œëŠ” ì•”í˜¸í™”ë˜ì–´ ì½ì„ ìˆ˜ ì—†ìŒ):

eyJhbGciOiJIUzI1NiJ9        â† ë´‰íˆ¬ (ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì„œëª…í–ˆëŠ”ì§€)
.eyJzdWIiOiIxIiwiZW1haWw...  â† í¸ì§€ ë‚´ìš© (userId, email, ë§Œë£Œ ì‹œê°„)
.SflKxwRJSMeKKF2QT4fwpM...  â† ë´‰ì¸ ë„ì¥ (ìœ„ì¡° ë°©ì§€ ì„œëª…)

ëˆ„ê°€ í¸ì§€ ë‚´ìš©ì„ ë°”ê¾¸ë©´? â†’ ë´‰ì¸ ë„ì¥ì´ ì•ˆ ë§ìŒ â†’ "ìœ„ì¡°!" íŒë³„ ê°€ëŠ¥
```

### Kafka â€” "ì´ˆëŒ€í˜• ìš°ì²´êµ­"

```
[ì¼ë°˜ ìš°ì²´êµ­]
í¸ì§€ë¥¼ ë³´ë‚´ë©´:
1. ìš°ì²´í†µì— ë„£ìŒ
2. ìš°ì²´êµ­ì´ ë¶„ë¥˜
3. ë°°ë‹¬ì›ì´ ë°°ë‹¬
4. ë°›ëŠ” ì‚¬ëŒì´ ì—†ìœ¼ë©´? ìš°ì²´êµ­ì´ ë³´ê´€í–ˆë‹¤ê°€ ë‚˜ì¤‘ì— ë°°ë‹¬

[Kafkaë„ ë˜‘ê°™ìŒ]
ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´:
1. Producer(ë°œì†¡ì¸)ê°€ Kafkaì— ì „ì†¡
2. Kafkaê°€ Topic(ë¶„ë¥˜í•¨)ì— ì €ì¥
3. Consumer(ìˆ˜ì‹ ì¸)ê°€ ê°€ì ¸ê°
4. Consumerê°€ ë°”ì˜ë©´? Kafkaê°€ ë³´ê´€í–ˆë‹¤ê°€ ë‚˜ì¤‘ì— ì „ë‹¬
```

**Kafkaë¥¼ ë” ìì„¸íˆ ëœ¯ì–´ë³´ë©´:**

```
ğŸ“® Topic(í† í”½) = ìš°í¸í•¨ì˜ ì¢…ë¥˜
   â”œâ”€â”€ chat.messages      = "ì±„íŒ… ë©”ì‹œì§€" ìš°í¸í•¨
   â””â”€â”€ chat.read-receipts = "ì½ìŒ í™•ì¸" ìš°í¸í•¨

ğŸ“¦ Partition(íŒŒí‹°ì…˜) = ìš°í¸í•¨ ì•ˆì˜ ì¹¸
   chat.messages í† í”½ (6ì¹¸ì§œë¦¬ ìš°í¸í•¨):
   â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
   â”‚ì¹¸ 0 â”‚ â”‚ì¹¸ 1 â”‚ â”‚ì¹¸ 2 â”‚ â”‚ì¹¸ 3 â”‚ â”‚ì¹¸ 4 â”‚ â”‚ì¹¸ 5 â”‚
   â”‚ë°©1  â”‚ â”‚ë°©2  â”‚ â”‚ë°©3  â”‚ â”‚ë°©1  â”‚ â”‚ë°©2  â”‚ â”‚ë°©3  â”‚
   â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜

   ì™œ ì¹¸ì„ ë‚˜ëˆ„ë‚˜? â†’ ê°™ì€ ë°©ì˜ ë©”ì‹œì§€ëŠ” ê°™ì€ ì¹¸ì—!
   â†’ ì¹¸ ì•ˆì—ì„œëŠ” ìˆœì„œê°€ ë³´ì¥ë¨!
   â†’ "ì•ˆë…•" ë‹¤ìŒì— "ë­í•´?"ê°€ í•­ìƒ ìˆœì„œëŒ€ë¡œ ì €ì¥

ğŸ“‹ Offset(ì˜¤í”„ì…‹) = ëª‡ ë²ˆì§¸ í¸ì§€ì¸ì§€
   ì¹¸ 0: [0ë²ˆ í¸ì§€] [1ë²ˆ í¸ì§€] [2ë²ˆ í¸ì§€] [3ë²ˆ í¸ì§€] ...
   â†’ Consumerê°€ "ë‚˜ëŠ” 2ë²ˆê¹Œì§€ ì½ì—ˆì–´" ë¼ê³  ê¸°ë¡
   â†’ ë‹¤ìŒì—ëŠ” 3ë²ˆë¶€í„° ì½ìŒ

ğŸ‘¥ Consumer Group = ê°™ì€ í¸ì§€ë¥¼ ë‹¤ë¥¸ ìš©ë„ë¡œ ì“°ëŠ” íŒ€
   íŒ€ A (chat-persistence): í¸ì§€ë¥¼ ë³µì‚¬í•´ì„œ ì°½ê³ (DB)ì— ë³´ê´€
   íŒ€ B (chat-broadcast):   í¸ì§€ë¥¼ ì½ê³  ëª¨ë“  ì‚¬ëŒì—ê²Œ ë°©ì†¡
   â†’ ê°™ì€ í¸ì§€ë¥¼ 2íŒ€ì´ ê°ê° ì²˜ë¦¬!
```

### WebSocket â€” "ì „í™” í†µí™”"

```
[HTTP = í¸ì§€]
í´ë¼ì´ì–¸íŠ¸: "ìƒˆ ë©”ì‹œì§€ ìˆì–´?" â†’ ì„œë²„: "ì—†ì–´"     (í¸ì§€ ë³´ë‚´ê³  ë‹µì¥ ë°›ê³ )
í´ë¼ì´ì–¸íŠ¸: "ìƒˆ ë©”ì‹œì§€ ìˆì–´?" â†’ ì„œë²„: "ì—†ì–´"     (ë˜ í¸ì§€ ë³´ë‚´ê³  ë‹µì¥ ë°›ê³ )
í´ë¼ì´ì–¸íŠ¸: "ìƒˆ ë©”ì‹œì§€ ìˆì–´?" â†’ ì„œë²„: "ìˆì–´! ì—¬ê¸°" (ë˜...)
â†’ ë§¤ë²ˆ ë¬¼ì–´ë´ì•¼ í•¨ (ë¹„íš¨ìœ¨ì !)

[WebSocket = ì „í™” í†µí™”]
í´ë¼ì´ì–¸íŠ¸ â†â”€â”€ì „í™” ì—°ê²°â”€â”€â†’ ì„œë²„  (í•œ ë²ˆ ì—°ê²°í•˜ë©´ ê³„ì† í†µí™” ì¤‘)
ì„œë²„: "ìƒˆ ë©”ì‹œì§€ ì™”ì–´!" (ì„œë²„ê°€ ë¨¼ì € ë§í•  ìˆ˜ ìˆìŒ)
ì„œë²„: "ë˜ ìƒˆ ë©”ì‹œì§€!" (ê³„ì† í†µí™” ì¤‘ì´ë‹ˆê¹Œ ë°”ë¡œ ì „ë‹¬)
â†’ ë¬¼ì–´ë³¼ í•„ìš” ì—†ì´ ì¦‰ì‹œ ì „ë‹¬! (ì‹¤ì‹œê°„!)
```

**STOMP = ì „í™” í†µí™” ë§¤ë„ˆ**
```
ì „í™” í†µí™”í•  ë•Œë„ ê·œì¹™ì´ ìˆì£ ?
"ì—¬ë³´ì„¸ìš”" â†’ "ë„¤, ë§ì”€í•˜ì„¸ìš”" â†’ "ì£¼ë¬¸í• ê²Œìš”" â†’ "ë„¤, ì ‘ìˆ˜í–ˆìŠµë‹ˆë‹¤"

STOMPëŠ” WebSocket ìœ„ì—ì„œ ì“°ëŠ” ê·œì¹™(í”„ë¡œí† ì½œ):
CONNECT:    "ì—¬ë³´ì„¸ìš”, ì € ê¹€ì² ìˆ˜ì¸ë°ìš”" (JWT í† í°ìœ¼ë¡œ ì‹ ë¶„ í™•ì¸)
SUBSCRIBE:  "1ë²ˆ ë°© ì†Œì‹ ë“£ê³  ì‹¶ì–´ìš”" (êµ¬ë…)
SEND:       "1ë²ˆ ë°©ì— 'ì•ˆë…•' ë³´ë‚´ì£¼ì„¸ìš”" (ë©”ì‹œì§€ ì „ì†¡)
MESSAGE:    "1ë²ˆ ë°©ì— ìƒˆ ë©”ì‹œì§€ ì™”ì–´ìš”!" (ì„œë²„ê°€ ì•Œë ¤ì¤Œ)
```

### Redis â€” "í™”ì´íŠ¸ë³´ë“œ + ë°©ì†¡ ìŠ¤í”¼ì»¤"

```
[í™”ì´íŠ¸ë³´ë“œ ì—­í•  = ìºì‹œ]
ì§ˆë¬¸: "1ë²ˆ ë°©ì—ì„œ ë‚´ê°€ ì•ˆ ì½ì€ ë©”ì‹œì§€ê°€ ëª‡ ê°œì•¼?"
DBì—ì„œ ì°¾ê¸°: 100ë§Œ ê±´ ë©”ì‹œì§€ë¥¼ ë’¤ì ¸ì„œ ê³„ì‚° â†’ 3ì´ˆ ê±¸ë¦¼
í™”ì´íŠ¸ë³´ë“œ: "3ê°œ"ë¼ê³  ì ì–´ë‘  â†’ ë°”ë¡œ ë‹µë³€ â†’ 0.001ì´ˆ!

â†’ ìì£¼ ë¬¼ì–´ë³´ëŠ” ì •ë³´ë¥¼ í™”ì´íŠ¸ë³´ë“œ(Redis)ì— ì ì–´ë‘ë©´ ë¹ ë¦„!
â†’ DBëŠ” "ì›ë³¸ ìë£Œì‹¤", RedisëŠ” "ë¹ ë¥¸ ë©”ëª¨ì¥"

[ë°©ì†¡ ìŠ¤í”¼ì»¤ ì—­í•  = Pub/Sub]
ì„œë²„ê°€ 2ëŒ€ì¸ë°, ë©”ì‹œì§€ë¥¼ ëª¨ë“  ì„œë²„ì— ì•Œë ¤ì•¼ í•¨:

ì„œë²„1: "1ë²ˆ ë°©ì— ìƒˆ ë©”ì‹œì§€!" â†’ ìŠ¤í”¼ì»¤(Redis)ë¡œ ë°©ì†¡
ì„œë²„2: ìŠ¤í”¼ì»¤ ì†Œë¦¬ ë“¤ìŒ â†’ "ì˜¤! ë‚´ ìª½ ì‚¬ìš©ìì—ê²Œ ì „ë‹¬í•´ì•¼ê² ë‹¤"

â†’ ì„œë²„ê°€ ëª‡ ëŒ€ë“  Redis ìŠ¤í”¼ì»¤ë¥¼ í†µí•´ ì „ë¶€ ë“¤ì„ ìˆ˜ ìˆìŒ!
```

### Docker Compose â€” "ê°€ì „ì œí’ˆ íŒ¨í‚¤ì§€"

```
ì´ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ ì´ê²ƒë“¤ì´ í•„ìš”:
1. PostgreSQL (ë°ì´í„°ë² ì´ìŠ¤)
2. Redis (ìºì‹œ + ë°©ì†¡)
3. Kafka (ë©”ì‹œì§€ í)

[Docker ì—†ì´]
â†’ PostgreSQL í™ˆí˜ì´ì§€ ê°€ì„œ ë‹¤ìš´ë¡œë“œ, ì„¤ì¹˜, ê³„ì • ìƒì„±, í…Œì´ë¸” ë§Œë“¤ê¸°...
â†’ Redis í™ˆí˜ì´ì§€ ê°€ì„œ ë‹¤ìš´ë¡œë“œ, ì„¤ì¹˜...
â†’ Kafka í™ˆí˜ì´ì§€ ê°€ì„œ ë‹¤ìš´ë¡œë“œ, ì„¤ì¹˜, ì„¤ì •...
â†’ ë°˜ë‚˜ì ˆ ê±¸ë¦¼

[Docker Compose ì‚¬ìš©]
â†’ docker compose up -d (ì´ í•œ ì¤„ì´ë©´ ë!)
â†’ 3ê°œ ì „ë¶€ ìë™ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ + ì„¤ì¹˜ + ì‹¤í–‰ + ì„¤ì •
â†’ 30ì´ˆ ê±¸ë¦¼
```

### Testcontainers â€” "ì¼íšŒìš© ì—°ìŠµ í™˜ê²½"

```
í…ŒìŠ¤íŠ¸í•  ë•Œ ë¬¸ì œ:
â†’ ì§„ì§œ DBì— í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë„£ìœ¼ë©´? ì§„ì§œ ë°ì´í„°ê°€ ì˜¤ì—¼ë¨!
â†’ í…ŒìŠ¤íŠ¸ìš© DBë¥¼ ë”°ë¡œ ì„¤ì¹˜? ê·€ì°®ìŒ...

Testcontainersì˜ í•´ê²°ë²•:
â†’ í…ŒìŠ¤íŠ¸ ì‹œì‘í•  ë•Œ: Dockerë¡œ ì„ì‹œ DB, Kafka, Redisë¥¼ ìë™ ìƒì„±
â†’ í…ŒìŠ¤íŠ¸í•  ë•Œ: ì´ ì„ì‹œ í™˜ê²½ì—ì„œ ë§ˆìŒê» í…ŒìŠ¤íŠ¸
â†’ í…ŒìŠ¤íŠ¸ ëë‚˜ë©´: ì„ì‹œ í™˜ê²½ ìë™ ì‚­ì œ

ë¹„ìœ : "ì—°ìŠµì¥"
â†’ ì‹œí—˜ì§€ì— ë°”ë¡œ ì“°ë©´ ì§€ìš¸ ìˆ˜ ì—†ìŒ (ì§„ì§œ DB)
â†’ ì—°ìŠµì¥ì— ë§ˆìŒê» í’€ê³  ë²„ë¦¼ (Testcontainers)
```

---

## 3. í´ë” êµ¬ì¡° â€” íšŒì‚¬ ì¡°ì§ë„ì²˜ëŸ¼ ì´í•´í•˜ê¸°

ì´ í”„ë¡œì íŠ¸ë¥¼ **íšŒì‚¬**ë¼ê³  ìƒê°í•´ë³´ì„¸ìš”:

```
src/main/java/com/realtime/chat/        â† ìš°ë¦¬ íšŒì‚¬

â”œâ”€â”€ ğŸ“‹ config/          = ê²½ì˜ì§€ì›íŒ€
â”‚   â”‚                     "íšŒì‚¬ ì „ì²´ ê·œì¹™ì„ ì •í•˜ëŠ” íŒ€"
â”‚   â”œâ”€â”€ SecurityConfig         â†’ ë³´ì•ˆ ì •ì±… (ëˆ„ê°€ ì¶œì… ê°€ëŠ¥í•œì§€)
â”‚   â”œâ”€â”€ KafkaConfig            â†’ ìš°ì²´êµ­ ê³„ì•½ (ì–´ë–¤ ìš°í¸í•¨ ì“¸ì§€)
â”‚   â”œâ”€â”€ WebSocketConfig        â†’ ì „í™” ì‹œìŠ¤í…œ ì„¤ì •
â”‚   â”œâ”€â”€ WebSocketAuthInterceptor â†’ ì „í™” ë°›ì„ ë•Œ ì‹ ë¶„ í™•ì¸
â”‚   â”œâ”€â”€ RateLimitInterceptor   â†’ ë„ë°° ë°©ì§€ ê·œì¹™ (2ì°¨)
â”‚   â”œâ”€â”€ WebSocketEventListener â†’ ì „í™” ì—°ê²°/ëŠê¹€ ê°ì§€ (2ì°¨)
â”‚   â””â”€â”€ RedisConfig            â†’ ë°©ì†¡ ì‹œìŠ¤í…œ ì„¤ì •
â”‚
â”œâ”€â”€ ğŸšª controller/     = ì•ˆë‚´ ë°ìŠ¤í¬
â”‚   â”‚                     "ê³ ê° ìš”ì²­ì„ ë°›ì•„ì„œ ë‹´ë‹¹ìì—ê²Œ ì „ë‹¬í•˜ëŠ” íŒ€"
â”‚   â”œâ”€â”€ AuthController         â†’ "ë¡œê·¸ì¸/íšŒì›ê°€ì…ì´ìš”" â†’ AuthServiceë¡œ ì—°ê²°
â”‚   â”œâ”€â”€ ChatRoomController     â†’ "ì±„íŒ…ë°© ë§Œë“¤ì–´ì£¼ì„¸ìš”" â†’ ChatRoomServiceë¡œ ì—°ê²°
â”‚   â”œâ”€â”€ MessageController      â†’ "ì´ì „ ëŒ€í™” ë³´ì—¬ì£¼ì„¸ìš”" â†’ MessageServiceë¡œ ì—°ê²°
â”‚   â”œâ”€â”€ ChatMessageController  â†’ "ì´ ë©”ì‹œì§€ ë³´ë‚´ì£¼ì„¸ìš”" â†’ Kafkaë¡œ ì „ë‹¬
â”‚   â””â”€â”€ PresenceController     â†’ "ëˆ„ê°€ ì ‘ì†ì¤‘ì´ì—ìš”?" â†’ PresenceServiceë¡œ ì—°ê²° (2ì°¨)
â”‚
â”œâ”€â”€ âš™ï¸ service/         = ì‹¤ë¬´íŒ€
â”‚   â”‚                     "ì‹¤ì œë¡œ ì¼í•˜ëŠ” íŒ€"
â”‚   â”œâ”€â”€ AuthService            â†’ íšŒì›ê°€ì…, ë¡œê·¸ì¸ ì²˜ë¦¬
â”‚   â”œâ”€â”€ ChatRoomService        â†’ ì±„íŒ…ë°© ë§Œë“¤ê¸°, ëª©ë¡ ì¡°íšŒ
â”‚   â”œâ”€â”€ MessageService         â†’ ë©”ì‹œì§€ ì´ë ¥ ì¡°íšŒ
â”‚   â”œâ”€â”€ ReadReceiptService     â†’ ì½ìŒ ì²˜ë¦¬
â”‚   â”œâ”€â”€ RedisPubSubService     â†’ ë°©ì†¡ ì†¡ì¶œ/ìˆ˜ì‹ 
â”‚   â””â”€â”€ PresenceService        â†’ ì ‘ì† ìƒíƒœ ê´€ë¦¬ (2ì°¨)
â”‚
â”œâ”€â”€ ğŸ“¨ consumer/        = íƒë°° ìˆ˜ë ¹íŒ€
â”‚   â”‚                     "Kafkaì—ì„œ ë©”ì‹œì§€ë¥¼ ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” íŒ€"
â”‚   â”œâ”€â”€ MessagePersistenceConsumer â†’ íƒë°° ë°›ìœ¼ë©´ ì°½ê³ (DB)ì— ë³´ê´€
â”‚   â”œâ”€â”€ MessageBroadcastConsumer   â†’ íƒë°° ë°›ìœ¼ë©´ ë°©ì†¡(Redis)ìœ¼ë¡œ ì•Œë¦¼
â”‚   â””â”€â”€ ReadReceiptConsumer        â†’ "ì½ìŒ í™•ì¸" íƒë°° ë°›ì•„ì„œ ì²˜ë¦¬
â”‚
â”œâ”€â”€ ğŸ“¤ producer/        = íƒë°° ë°œì†¡íŒ€
â”‚   â””â”€â”€ ChatMessageProducer    â†’ ë©”ì‹œì§€ë¥¼ Kafka ìš°ì²´êµ­ì— ì ‘ìˆ˜
â”‚
â”œâ”€â”€ ğŸ›ï¸ domain/          = ë°ì´í„° ì„¤ê³„ë„
â”‚   â”‚                     "DB í…Œì´ë¸”ì´ ì–´ë–»ê²Œ ìƒê²¼ëŠ”ì§€ ì •ì˜"
â”‚   â”œâ”€â”€ User                   â†’ ì‚¬ìš©ì (ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸, ë‹‰ë„¤ì„)
â”‚   â”œâ”€â”€ ChatRoom               â†’ ì±„íŒ…ë°© (ì´ë¦„, íƒ€ì…)
â”‚   â”œâ”€â”€ ChatRoomMember         â†’ ì±„íŒ…ë°© ë©¤ë²„ (ëˆ„ê°€ ì–´ëŠ ë°©ì— ìˆëŠ”ì§€)
â”‚   â””â”€â”€ Message                â†’ ë©”ì‹œì§€ (ë‚´ìš©, ë³´ë‚¸ ì‚¬ëŒ, ì‹œê°„)
â”‚
â”œâ”€â”€ ğŸ“‘ dto/             = ì„œë¥˜ ì–‘ì‹
â”‚   â”‚                     "ì™¸ë¶€ì™€ ì£¼ê³ ë°›ëŠ” ë°ì´í„° í˜•ì‹"
â”‚   â”œâ”€â”€ SignupRequest          â†’ íšŒì›ê°€ì… ì‹ ì²­ì„œ {email, password, nickname}
â”‚   â”œâ”€â”€ LoginRequest           â†’ ë¡œê·¸ì¸ ì‹ ì²­ì„œ {email, password}
â”‚   â”œâ”€â”€ AuthResponse           â†’ ë¡œê·¸ì¸ ê²°ê³¼ì„œ {token, userId, ...}
â”‚   â”œâ”€â”€ SendMessageRequest     â†’ ë©”ì‹œì§€ ì „ì†¡ ì–‘ì‹ {roomId, content}
â”‚   â””â”€â”€ PresenceEvent          â†’ ì ‘ì† ìƒíƒœ ì•Œë¦¼ {userId, status} (2ì°¨)
â”‚
â”œâ”€â”€ ğŸ“¦ event/           = íƒë°° í¬ì¥ ê·œê²©
â”‚   â”‚                     "Kafkaë¡œ ë³´ë‚´ëŠ” ë©”ì‹œì§€ í˜•ì‹"
â”‚   â”œâ”€â”€ ChatMessageEvent       â†’ ì±„íŒ… ë©”ì‹œì§€ íƒë°° í¬ì¥
â”‚   â””â”€â”€ ReadReceiptEvent       â†’ ì½ìŒ í™•ì¸ íƒë°° í¬ì¥
â”‚
â”œâ”€â”€ ğŸ’¾ repository/      = ì°½ê³  ê´€ë¦¬íŒ€
â”‚   â”‚                     "DBì—ì„œ ë°ì´í„°ë¥¼ êº¼ë‚´ê³  ë„£ëŠ” íŒ€"
â”‚   â”œâ”€â”€ UserRepository
â”‚   â”œâ”€â”€ ChatRoomRepository
â”‚   â”œâ”€â”€ ChatRoomMemberRepository
â”‚   â””â”€â”€ MessageRepository
â”‚
â””â”€â”€ ğŸ”§ common/          = ê³µìš© ë„êµ¬í•¨
    â”‚                     "ì—¬ëŸ¬ íŒ€ì—ì„œ ê³µí†µìœ¼ë¡œ ì“°ëŠ” ë„êµ¬"
    â”œâ”€â”€ JwtTokenProvider       â†’ JWT í† í° ì œì¡°ê¸°
    â”œâ”€â”€ JwtAuthenticationFilter â†’ ëª¨ë“  ìš”ì²­ì˜ í† í° ê²€ì‚¬ê´€
    â”œâ”€â”€ GlobalExceptionHandler â†’ ì—ëŸ¬ ë°œìƒ ì‹œ ê¹”ë”í•œ ë‹µë³€ ìƒì„±
    â””â”€â”€ BusinessException      â†’ "ì´ë©”ì¼ ì¤‘ë³µ!" ê°™ì€ ì—…ë¬´ ì—ëŸ¬
```

**DTO vs Entity â€” ì™œ ë”°ë¡œ ë§Œë“¤ì–´?**

```
ë¹„ìœ : ì´ë ¥ì„œ vs ì£¼ë¯¼ë“±ë¡ë“±ë³¸

[Entity = ì£¼ë¯¼ë“±ë¡ë“±ë³¸]
ì´ë¦„, ì£¼ë¯¼ë²ˆí˜¸, ì£¼ì†Œ, ê°€ì¡±ê´€ê³„, ë²”ì£„ì´ë ¥...
â†’ ëª¨ë“  ê°œì¸ì •ë³´ê°€ ë‹¤ ìˆìŒ
â†’ í•¨ë¶€ë¡œ ë³´ì—¬ì£¼ë©´ ì•ˆ ë¨!

[DTO = ì´ë ¥ì„œ]
ì´ë¦„, ì´ë©”ì¼, ìê¸°ì†Œê°œ
â†’ ë³´ì—¬ì¤˜ë„ ë˜ëŠ” ì •ë³´ë§Œ ê³¨ë¼ì„œ ë„£ìŒ

ì½”ë“œë¡œ ë³´ë©´:
User Entity:  { id, email, PASSWORD, nickname, status, lastSeenAt, createdAt }
                              â†‘ ë¹„ë°€ë²ˆí˜¸! ì ˆëŒ€ ì™¸ë¶€ì— ë³´ë‚´ë©´ ì•ˆ ë¨!

AuthResponse DTO: { token, userId, email, nickname }
                    â†’ í•„ìš”í•œ ê²ƒë§Œ ê³¨ë¼ì„œ ì‘ë‹µ
```

---

# Part 2: 1ì°¨ êµ¬í˜„ (MVP) â€” ì¼ë‹¨ ë™ì‘í•˜ê²Œ ë§Œë“¤ê¸°

> MVP = Minimum Viable Product (ìµœì†Œ ë™ì‘ ì œí’ˆ)
> "ëª¨ë“  ê¸°ëŠ¥ì„ ë‹¤ ë§Œë“¤ê¸° ì „ì—, í•µì‹¬ ê¸°ëŠ¥ë§Œ ë¨¼ì € ë§Œë“¤ì–´ì„œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ì!"

---

## 4. STEP 1: í”„ë¡œì íŠ¸ ë¼ˆëŒ€

### build.gradle.kts â€” ì‡¼í•‘ ëª©ë¡

ì¹´í˜ë¥¼ ì°¨ë¦´ ë•Œ ë­ê°€ í•„ìš”í• ê¹Œìš”? ì»¤í”¼ë¨¸ì‹ , ì»µ, ì›ë‘, ëƒ‰ì¥ê³ ...
í”„ë¡œì íŠ¸ë„ ë§ˆì°¬ê°€ì§€ë¡œ "í•„ìš”í•œ ë„êµ¬ ëª©ë¡"ì´ ìˆìŠµë‹ˆë‹¤.

```kotlin
dependencies {
    // ì¹´í˜ ê¸°ë³¸ ì¥ë¹„
    implementation("spring-boot-starter-web")        // ì›¹ ì„œë²„ (ì¹´ìš´í„°)
    implementation("spring-boot-starter-websocket")  // ì‹¤ì‹œê°„ í†µì‹  (ì¸í„°í°)
    implementation("spring-boot-starter-data-jpa")   // DB ì—°ê²° (ê¸ˆê³ )
    implementation("spring-boot-starter-data-redis")  // ë¹ ë¥¸ ë©”ëª¨ì¥ (í™”ì´íŠ¸ë³´ë“œ)
    implementation("spring-boot-starter-security")   // ë³´ì•ˆ (ìë¬¼ì‡ )
    implementation("spring-boot-starter-validation") // ì…ë ¥ ê²€ì‚¬ (ì£¼ë¬¸ì„œ í™•ì¸)
    implementation("spring-boot-starter-actuator")   // ê±´ê°• ê²€ì§„ (ì˜¨ë„ê³„) â† 2ì°¨

    // íŠ¹ìˆ˜ ì¥ë¹„
    implementation("spring-kafka")                   // ìš°ì²´êµ­ ì—°ê²° (Kafka)
    implementation("io.jsonwebtoken:jjwt-api")       // ì†ëª©ë°´ë“œ ì œì¡°ê¸° (JWT)
    runtimeOnly("org.postgresql:postgresql")         // DB ë“œë¼ì´ë²„ (ê¸ˆê³  ì—´ì‡ )
}
```

### docker-compose.yml â€” "í•œ ë²ˆì— ë‹¤ ì¼œê¸°"

```yaml
services:
  postgres:          # ê¸ˆê³  (ë°ì´í„° ì˜êµ¬ ì €ì¥)
    image: postgres:16-alpine
    ports: ["5432:5432"]
    # â†’ localhost:5432ì—ì„œ ì ‘ì† ê°€ëŠ¥

  redis:             # í™”ì´íŠ¸ë³´ë“œ + ìŠ¤í”¼ì»¤ (ë¹ ë¥¸ ì €ì¥ + ë°©ì†¡)
    image: redis:7-alpine
    ports: ["6379:6379"]

  kafka:             # ìš°ì²´êµ­ (ë©”ì‹œì§€ ìˆœì„œ ë³´ì¥)
    image: apache/kafka:3.9.0
    ports: ["29092:29092"]
    # KRaft ëª¨ë“œ: ì˜ˆì „ì—ëŠ” Kafka + Zookeeper 2ê°œë¥¼ ì¼œì•¼ í–ˆëŠ”ë°
    # ì´ì œ Kafka í˜¼ìì„œë„ ë¨ (ë” ê°„ë‹¨!)

  kafka-ui:          # ìš°ì²´êµ­ í˜„í™©íŒ (ì›¹ ë¸Œë¼ìš°ì €ë¡œ í™•ì¸)
    ports: ["8090:8080"]
    # â†’ http://localhost:8090 ì—ì„œ Kafka í† í”½/ë©”ì‹œì§€ í™•ì¸ ê°€ëŠ¥
```

### application.yml â€” "ì•± ì„¤ì •ì„œ"

```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/chat   # DB ì£¼ì†Œ (ê¸ˆê³  ìœ„ì¹˜)
    username: chat                                # DB ê³„ì •
    password: chat1234                            # DB ë¹„ë°€ë²ˆí˜¸

  jpa:
    hibernate:
      ddl-auto: validate  # "í…Œì´ë¸”ì´ ì˜ ë§Œë“¤ì–´ì ¸ ìˆëŠ”ì§€ í™•ì¸ë§Œ í•´ì¤˜"
                           # (ì§ì ‘ ë§Œë“¤ê±°ë‚˜ ë°”ê¾¸ì§€ ë§ˆ!)
    open-in-view: false    # ì„±ëŠ¥ ìµœì í™” (ë‚˜ì¤‘ì— ì„¤ëª…)

  kafka:
    bootstrap-servers: localhost:29092   # ìš°ì²´êµ­ ì£¼ì†Œ
    consumer:
      enable-auto-commit: false         # "ë‚´ê°€ ì§ì ‘ 'ì½ì—ˆì–´'ë¼ê³  ë§í• ê²Œ"
                                        # (ìë™ìœ¼ë¡œ í•˜ë©´ ìœ„í—˜!)

jwt:
  secret: realtime-chat-jwt-...  # ì†ëª©ë°´ë“œ ë§Œë“œëŠ” ë¹„ë°€ ë„ì¥
  expiration: 86400000            # 24ì‹œê°„ = 86,400,000 ë°€ë¦¬ì´ˆ
```

**`enable-auto-commit: false`ê°€ ì™œ ì¤‘ìš”í•´?**

```
ë¹„ìœ : íƒë°° ìˆ˜ë ¹ í™•ì¸

[ìë™ í™•ì¸ (auto-commit = true)]
1. íƒë°°ê°€ ë„ì°©
2. "ìˆ˜ë ¹ ì™„ë£Œ!" ìë™ìœ¼ë¡œ ì‚¬ì¸ â† ì—¬ê¸°!
3. íƒë°° ëœ¯ì–´ë³´ëŠ”ë°... ë¬¼ê±´ì´ ê¹¨ì ¸ìˆìŒ!
4. "ìˆ˜ë ¹ ì™„ë£Œ"ë¼ê³  ì´ë¯¸ ì‚¬ì¸í–ˆìœ¼ë‹ˆ êµí™˜ ë¶ˆê°€!
â†’ ë¬¸ì œ: ë¬¼ê±´ì„ í™•ì¸í•˜ê¸°ë„ ì „ì— "ë°›ì•˜ë‹¤"ê³  í•´ë²„ë¦¼

[ìˆ˜ë™ í™•ì¸ (auto-commit = false) â€” ìš°ë¦¬ ì„ íƒ]
1. íƒë°°ê°€ ë„ì°©
2. íƒë°° ëœ¯ì–´ì„œ ë¬¼ê±´ í™•ì¸
3. ë¬¼ê±´ ë©€ì©¡í•¨! â†’ "ìˆ˜ë ¹ ì™„ë£Œ!" ì‚¬ì¸
4. ë§Œì•½ ë¬¼ê±´ì´ ê¹¨ì ¸ìˆì—ˆë‹¤ë©´? â†’ ì‚¬ì¸ ì•ˆ í•¨ â†’ ë‹¤ì‹œ ë°°ë‹¬í•´ì¤˜!
â†’ ì•ˆì „: ì²˜ë¦¬ê°€ ì™„ë£Œëœ í›„ì—ë§Œ "ë°›ì•˜ë‹¤"ê³  í•¨
```

---

## 5. STEP 2: ë°ì´í„°ë² ì´ìŠ¤

### 4ê°œì˜ í…Œì´ë¸” â€” ì—‘ì…€ ì‹œíŠ¸ë¼ê³  ìƒê°í•˜ì„¸ìš”

```
ğŸ“Š users ì‹œíŠ¸ (ì‚¬ìš©ì)
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚    email     â”‚ password  â”‚nicknameâ”‚  status  â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1 â”‚ a@test.com   â”‚ $2a$10$..â”‚ ì² ìˆ˜   â”‚ ONLINE   â”‚
â”‚  2 â”‚ b@test.com   â”‚ $2a$10$..â”‚ ì˜í¬   â”‚ OFFLINE  â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š chat_rooms ì‹œíŠ¸ (ì±„íŒ…ë°©)
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚   name   â”‚  type  â”‚ created_by â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1 â”‚  null    â”‚ DIRECT â”‚     1      â”‚  â† 1:1ë°©ì€ ì´ë¦„ ì—†ìŒ
â”‚  2 â”‚ ìŠ¤í„°ë””ë°© â”‚ GROUP  â”‚     1      â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š chat_room_members ì‹œíŠ¸ (ëˆ„ê°€ ì–´ëŠ ë°©ì— ìˆë‚˜)
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ room_id â”‚ user_id â”‚unread_count  â”‚last_read_msg â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1 â”‚    1    â”‚    1    â”‚      0       â”‚     50       â”‚
â”‚  2 â”‚    1    â”‚    2    â”‚      3       â”‚     47       â”‚ â† ì˜í¬ëŠ” 3ê°œ ì•ˆ ì½ìŒ
â”‚  3 â”‚    2    â”‚    1    â”‚      0       â”‚     30       â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š messages ì‹œíŠ¸ (ë©”ì‹œì§€)
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚          message_key            â”‚ room_id â”‚sender_id â”‚ content â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 47 â”‚ 550e8400-e29b-41d4-a716-446655 â”‚    1    â”‚    1     â”‚ ì•ˆë…•    â”‚
â”‚ 48 â”‚ 6ba7b810-9dad-11d1-80b4-00c04f â”‚    1    â”‚    2     â”‚ ë°˜ê°€ì›Œ  â”‚
â”‚ 50 â”‚ f47ac10b-58cc-4372-a567-0e02b2 â”‚    1    â”‚    1     â”‚ ë­í•´?  â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†‘ ì´ê²Œ ë­ì•¼? â†’ "ë©±ë“±ì„± í‚¤" â€” ì•„ë˜ì—ì„œ ìì„¸íˆ ì„¤ëª…!
```

### Entity â€” Java í´ë˜ìŠ¤ = DB í…Œì´ë¸”

```java
@Entity                          // "ì´ í´ë˜ìŠ¤ëŠ” DB í…Œì´ë¸”ì´ì•¼!"
@Table(name = "users")           // "í…Œì´ë¸” ì´ë¦„ì€ users"
public class User {

    @Id                          // "ì´ í•„ë“œê°€ ê³ ìœ  ë²ˆí˜¸(Primary Key)"
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    // â†‘ "ë²ˆí˜¸ëŠ” DBê°€ ìë™ìœ¼ë¡œ 1, 2, 3... ë§¤ê²¨ì¤˜"
    private Long id;

    @Column(nullable = false, unique = true)
    // â†‘ nullable = false: ë¹ˆì¹¸ ë¶ˆê°€!
    //   unique = true:    ê°™ì€ ì´ë©”ì¼ ì¤‘ë³µ ë¶ˆê°€!
    private String email;
}
```

### ë©±ë“±ì„±(Idempotency) â€” "ê°™ì€ íƒë°°ë¥¼ ë‘ ë²ˆ ë°›ì§€ ì•ŠëŠ” ë°©ë²•"

ì´ ê°œë…ì´ ì´ í”„ë¡œì íŠ¸ì—ì„œ **ì •ë§ ì¤‘ìš”**í•©ë‹ˆë‹¤!

```
[ë¬¸ì œ ìƒí™© â€” ê°™ì€ ë©”ì‹œì§€ê°€ 2ë²ˆ ì €ì¥ë¨]

1. ì‚¬ìš©ìê°€ "ì•ˆë…•" ì „ì†¡
2. Kafka â†’ Consumerê°€ "ì•ˆë…•"ì„ DBì— ì €ì¥ âœ“
3. Consumerê°€ Kafkaì— "ì²˜ë¦¬ ì™„ë£Œ!" ë³´ë‚´ë ¤ëŠ” ìˆœê°„... ì„œë²„ ë‹¤ìš´!
4. ì„œë²„ ì¬ì‹œì‘ â†’ Kafka: "ì•„ê¹Œ ê·¸ ë©”ì‹œì§€ ì²˜ë¦¬ ì•ˆ ëë„¤? ë‹¤ì‹œ ë³´ë‚´ì¤„ê²Œ"
5. Consumerê°€ "ì•ˆë…•"ì„ ë˜ DBì— ì €ì¥ â† ê°™ì€ ë©”ì‹œì§€ê°€ 2ê°œ!

[í•´ê²° â€” messageKey (UUID)]

ê° ë©”ì‹œì§€ì— ì„¸ìƒì—ì„œ ìœ ì¼í•œ IDë¥¼ ë¶€ì—¬:
"ì•ˆë…•" â†’ messageKey: "550e8400-e29b-41d4-a716-446655440000"

Consumerê°€ ë°›ì„ ë•Œ:
1. "550e8400... ì´ë¯¸ ìˆì–´?" â†’ DB í™•ì¸
2. ì—†ìœ¼ë©´ â†’ ì €ì¥
3. ìˆìœ¼ë©´ â†’ "ì•„, ì´ë¯¸ ì €ì¥í•œ ê±°êµ¬ë‚˜" â†’ ìŠ¤í‚µ!

ë¹„ìœ : íƒë°° ì†¡ì¥ ë²ˆí˜¸
ê°™ì€ ì†¡ì¥ ë²ˆí˜¸ì˜ íƒë°°ê°€ 2ë²ˆ ì˜¤ë©´?
"ì•„, ì´ê±° ì•„ê¹Œ ë°›ì€ ê±°ì–ì•„" â†’ ë°˜ì†¡!
```

### Repository â€” "DBì— ë­ ì¢€ í•´ì¤˜" ìš”ì²­ì„œ

```java
public interface MessageRepository extends JpaRepository<Message, Long> {

    // ë©”ì„œë“œ ì´ë¦„ë§Œ ì“°ë©´ JPAê°€ SQLì„ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì¤Œ!

    boolean existsByMessageKey(UUID messageKey);
    // â†’ "ì´ messageKeyê°€ DBì— ìˆì–´?" (ë©±ë“±ì„± ì²´í¬ìš©)
    // â†’ SQL: SELECT EXISTS(SELECT 1 FROM messages WHERE message_key = ?)

    long countByMessageKey(UUID messageKey);
    // â†’ "ì´ messageKeyê°€ ëª‡ ê°œì•¼?" (í…ŒìŠ¤íŠ¸ìš©)
    // â†’ SQL: SELECT COUNT(*) FROM messages WHERE message_key = ?
}
```

```
JPAê°€ ë©”ì„œë“œ ì´ë¦„ì„ í•´ì„í•˜ëŠ” ë°©ë²•:

findByEmail("a@test.com")
find + By + Email
"ì°¾ì•„" + "~ë¡œ" + "ì´ë©”ì¼"
â†’ SELECT * FROM users WHERE email = 'a@test.com'

existsByMessageKey(uuid)
exists + By + MessageKey
"ì¡´ì¬í•´?" + "~ë¡œ" + "ë©”ì‹œì§€í‚¤"
â†’ SELECT EXISTS(SELECT 1 FROM messages WHERE message_key = uuid)

ì˜ì–´ ë¬¸ì¥ ì½ë“¯ì´ ë©”ì„œë“œ ì´ë¦„ì„ ì“°ë©´ JPAê°€ SQLì„ ë§Œë“¤ì–´ì¤Œ!
```

---

## 6. STEP 3: ë¡œê·¸ì¸

### ì „ì²´ íë¦„ â€” ë†€ì´ê³µì› ì…ì¥

```
[1ë‹¨ê³„: íšŒì›ê°€ì… = ì—°ê°„ íšŒì› ë“±ë¡]

POST /api/auth/signup
ìš”ì²­: { "email": "a@b.com", "password": "1234", "nickname": "ì² ìˆ˜" }

ì„œë²„ê°€ í•˜ëŠ” ì¼:
1. "a@b.com ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆë‚˜?" â†’ DB í™•ì¸
2. "1234"ë¥¼ ì•”í˜¸í™” â†’ "$2a$10$N9qo8uLO..." (ì›ë˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œ ìˆ˜ ì—†ê²Œ!)
3. DBì— ì €ì¥: { email: "a@b.com", password: "$2a$10$...", nickname: "ì² ìˆ˜" }
4. JWT í† í°(ì†ëª©ë°´ë“œ) ë°œê¸‰
5. ì‘ë‹µ: { "token": "eyJ...", "userId": 1, "email": "a@b.com", "nickname": "ì² ìˆ˜" }
```

```
[2ë‹¨ê³„: ë¡œê·¸ì¸ = ì—°ê°„ íšŒì› ì¬ë°©ë¬¸]

POST /api/auth/login
ìš”ì²­: { "email": "a@b.com", "password": "1234" }

ì„œë²„ê°€ í•˜ëŠ” ì¼:
1. "a@b.com" â†’ DBì—ì„œ ì°¾ê¸°
2. ì…ë ¥í•œ "1234"ì™€ DBì˜ "$2a$10$..." ë¹„êµ â†’ BCryptê°€ ì•Œì•„ì„œ íŒë³„
3. ì¼ì¹˜! â†’ JWT í† í° ë°œê¸‰
4. ì‘ë‹µ: { "token": "eyJ...", ... }
```

```
[3ë‹¨ê³„: ì´í›„ ëª¨ë“  ìš”ì²­ = ë†€ì´ê¸°êµ¬ íƒˆ ë•Œë§ˆë‹¤ ë°´ë“œ í™•ì¸]

GET /api/rooms
Headers: Authorization: Bearer eyJ...
                                 â†‘ ì´ í† í°ì„ ë§¤ë²ˆ ê°™ì´ ë³´ëƒ„

ì„œë²„ê°€ í•˜ëŠ” ì¼:
1. JwtAuthenticationFilterê°€ ìë™ìœ¼ë¡œ í† í° í™•ì¸
2. í† í° â†’ "userId=1, ìœ íš¨ê¸°ê°„ OK" â†’ í†µê³¼!
3. Controllerì—ì„œ @AuthenticationPrincipal Long userId = 1 ìë™ ì£¼ì…
4. "1ë²ˆ ìœ ì €ì˜ ì±„íŒ…ë°© ëª©ë¡" ì¡°íšŒí•´ì„œ ì‘ë‹µ
```

### ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” â€” ì™œ ê·¸ëƒ¥ ì €ì¥í•˜ë©´ ì•ˆ ë¼?

```
[ë¹„ë°€ë²ˆí˜¸ë¥¼ ê·¸ëŒ€ë¡œ ì €ì¥í•˜ë©´]
DB: { email: "a@b.com", password: "1234" }
â†’ í•´ì»¤ê°€ DBë¥¼ ëš«ìœ¼ë©´? ëª¨ë“  ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œê²Œ ë¨!
â†’ ê°™ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì—ì„œë„ ì“°ëŠ” ì‚¬ëŒì´ ë§ìŒ â†’ ì—°ì‡„ í”¼í•´

[BCryptë¡œ ì•”í˜¸í™”í•˜ë©´]
DB: { email: "a@b.com", password: "$2a$10$N9qo8uLOickgx2ZMRZoMye..." }
â†’ í•´ì»¤ê°€ DBë¥¼ ëš«ì–´ë„ ì›ë˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œ ìˆ˜ ì—†ìŒ!
â†’ "$2a$10$..."ì—ì„œ "1234"ë¥¼ ì—­ì‚°í•˜ëŠ” ê±´ ìˆ˜í•™ì ìœ¼ë¡œ ë¶ˆê°€ëŠ¥

"1234" â†’ BCrypt â†’ "$2a$10$N9qo8uLO..."  (í•œ ë°©í–¥ìœ¼ë¡œë§Œ ë³€í™˜ ê°€ëŠ¥)
"$2a$10$N9qo8uLO..." â†’ ??? â†’ ì›ë³¸ ë³µì› ë¶ˆê°€ëŠ¥!

ê·¸ëŸ¬ë©´ ë¡œê·¸ì¸í•  ë•Œ ì–´ë–»ê²Œ í™•ì¸í•´?
â†’ ì…ë ¥í•œ "1234"ë¥¼ ë‹¤ì‹œ BCryptë¡œ ë³€í™˜ â†’ DBì˜ ê°’ê³¼ ë¹„êµ
â†’ ê°™ìœ¼ë©´ "ë¹„ë°€ë²ˆí˜¸ ë§ìŒ!", ë‹¤ë¥´ë©´ "í‹€ë¦¼!"
```

### Spring Security í•„í„° ì²´ì¸ â€” "ë³´ì•ˆ ê²€ë¬¸ì†Œ"

```
ëª¨ë“  HTTP ìš”ì²­ì´ Controllerì— ë„ì°©í•˜ê¸° ì „ì— ì—¬ëŸ¬ ê²€ë¬¸ì†Œë¥¼ ê±°ì¹¨:

HTTP ìš”ì²­ ë„ì°©
    â”‚
    â–¼
[ê²€ë¬¸ì†Œ 1: CORS í•„í„°]     "ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì—ì„œ ì˜¨ ìš”ì²­ì¸ê°€?"
    â”‚
    â–¼
[ê²€ë¬¸ì†Œ 2: CSRF í•„í„°]     "ìœ„ì¡°ëœ ìš”ì²­ì¸ê°€?" (ìš°ë¦¬ëŠ” JWTë¼ì„œ OFF)
    â”‚
    â–¼
[ê²€ë¬¸ì†Œ 3: JWT í•„í„°]      "í† í° ìˆì–´? ìœ íš¨í•´?" â† ìš°ë¦¬ê°€ ë§Œë“  ê²ƒ!
    â”‚                     â†’ í† í° ìœ íš¨í•˜ë©´: "userId=1" ê¸°ë¡
    â”‚                     â†’ í† í° ì—†ìœ¼ë©´: ê·¸ëƒ¥ í†µê³¼ (ë‹¤ìŒì—ì„œ íŒë‹¨)
    â–¼
[ê²€ë¬¸ì†Œ 4: ì¸ê°€ í•„í„°]     "ì´ URLì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì‚¬ëŒì´ì•¼?"
    â”‚                     â†’ /api/auth/** â†’ ì•„ë¬´ë‚˜ OK (permitAll)
    â”‚                     â†’ /api/rooms/** â†’ userId ìˆì–´ì•¼ í•¨ (authenticated)
    â”‚                     â†’ userId ì—†ì´ /api/rooms ì ‘ê·¼? â†’ 401 Unauthorized!
    â–¼
[Controller]              ëª¨ë“  ê²€ë¬¸ì†Œ í†µê³¼! ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰
```

---

## 7. STEP 4: ì±„íŒ…ë°©

### 1:1 ì±„íŒ…ë°© â€” "ì´ë¯¸ ëŒ€í™”í•œ ì  ìˆëŠ”ì§€ í™•ì¸"

ì¹´ì¹´ì˜¤í†¡ì—ì„œ ì¹œêµ¬ì—ê²Œ 1:1 ì±„íŒ…ì„ ì‹œì‘í•˜ë©´:
- **ì²˜ìŒì´ë©´**: ìƒˆ ì±„íŒ…ë°© ìƒì„±
- **ì´ì „ì— ëŒ€í™”í•œ ì  ìˆìœ¼ë©´**: ê¸°ì¡´ ì±„íŒ…ë°© ì—´ê¸°

```java
// "Aì™€ B ì‚¬ì´ì— ì´ë¯¸ 1:1 ë°©ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ë°˜í™˜, ì—†ìœ¼ë©´ ìƒˆë¡œ ë§Œë“¤ê¸°"
public ChatRoomResponse createDirectRoom(Long userId, CreateDirectRoomRequest request) {

    // 1. ìê¸° ìì‹ ê³¼ì˜ ì±„íŒ…? â†’ ì°¨ë‹¨!
    if (userId.equals(request.getTargetUserId())) {
        throw new BusinessException("ìê¸° ìì‹ ê³¼ì˜ ì±„íŒ…ë°©ì€ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }

    // 2. ê¸°ì¡´ 1:1 ë°©ì´ ìˆëŠ”ì§€ ì°¾ê¸°
    return chatRoomRepository.findDirectRoomByUsers(DIRECT, userId, targetUserId)
            .map(ChatRoomResponse::from)     // ì°¾ì•˜ìœ¼ë©´ â†’ ê·¸ëŒ€ë¡œ ë°˜í™˜
            .orElseGet(() -> {               // ì—†ìœ¼ë©´ â†’ ìƒˆë¡œ ìƒì„±
                ChatRoom room = new ChatRoom(null, DIRECT, currentUser);
                room.addMember(currentUser);   // ë‚˜ë¥¼ ë©¤ë²„ë¡œ ì¶”ê°€
                room.addMember(targetUser);    // ìƒëŒ€ë¥¼ ë©¤ë²„ë¡œ ì¶”ê°€
                chatRoomRepository.save(room);
                return ChatRoomResponse.from(room);
            });
}
```

### @AuthenticationPrincipal â€” "ì§€ê¸ˆ ë¡œê·¸ì¸í•œ ì‚¬ëŒì´ ëˆ„êµ¬ì•¼?"

```java
@PostMapping("/direct")
public ResponseEntity<ChatRoomResponse> createDirectRoom(
        @AuthenticationPrincipal Long userId,  // â† ìë™ìœ¼ë¡œ í˜„ì¬ ë¡œê·¸ì¸í•œ ìœ ì €ì˜ IDê°€ ë“¤ì–´ì˜´!
        @RequestBody CreateDirectRoomRequest request) {
    // ...
}
```

```
ì–´ë–»ê²Œ ìë™ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ê±°ì•¼?

1. í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­: "Authorization: Bearer eyJ..."
2. JwtAuthenticationFilterê°€ í† í°ì—ì„œ userId=1 ì¶”ì¶œ
3. Spring Securityì— "ì§€ê¸ˆ 1ë²ˆ ìœ ì €ê°€ ìš”ì²­ ì¤‘" ê¸°ë¡
4. Controllerì˜ @AuthenticationPrincipal â†’ "1ë²ˆ ìœ ì €ìš”!" â†’ userId = 1

â†’ Controller ì½”ë“œì—ì„œ ë¡œê·¸ì¸ ì²˜ë¦¬ë¥¼ ì‹ ê²½ ì“¸ í•„ìš” ì—†ìŒ!
â†’ ë§¤ë²ˆ í† í° íŒŒì‹±í•˜ëŠ” ì½”ë“œë¥¼ ë°˜ë³µí•  í•„ìš” ì—†ìŒ!
```

---

## 8. STEP 5: Kafka

### Producer â€” "ìš°ì²´êµ­ì— í¸ì§€ ì ‘ìˆ˜"

```java
public void sendMessage(ChatMessageEvent event) {
    String key = String.valueOf(event.getRoomId());  // ë¶„ë¥˜ ê¸°ì¤€ = ë°© ë²ˆí˜¸
    kafkaTemplate.send("chat.messages", key, event);
    //                  â†‘ ìš°í¸í•¨ ì´ë¦„   â†‘ ë¶„ë¥˜í‚¤  â†‘ í¸ì§€ ë‚´ìš©
}
```

```
ì™œ key = roomIdì¸ê°€?

KafkaëŠ” keyë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŒŒí‹°ì…˜(ì¹¸)ì„ ì •í•¨:
â†’ roomId=1ì¸ ë©”ì‹œì§€ â†’ í•­ìƒ íŒŒí‹°ì…˜ 3ì— ì €ì¥ (ì˜ˆì‹œ)
â†’ roomId=2ì¸ ë©”ì‹œì§€ â†’ í•­ìƒ íŒŒí‹°ì…˜ 1ì— ì €ì¥

ê°™ì€ íŒŒí‹°ì…˜ ì•ˆì—ì„œëŠ” ìˆœì„œê°€ ë³´ì¥ë¨!
â†’ 1ë²ˆ ë°©ì˜ "ì•ˆë…•" â†’ "ë­í•´?" â†’ "ë°¥ ë¨¹ì" ìˆœì„œê°€ ì ˆëŒ€ ë°”ë€Œì§€ ì•ŠìŒ!

ë§Œì•½ keyê°€ ì—†ìœ¼ë©´?
â†’ ë©”ì‹œì§€ê°€ ëœë¤ íŒŒí‹°ì…˜ìœ¼ë¡œ í©ì–´ì§
â†’ "ë°¥ ë¨¹ì"ê°€ "ì•ˆë…•"ë³´ë‹¤ ë¨¼ì € ì „ë‹¬ë  ìˆ˜ ìˆìŒ!
â†’ ì±„íŒ…ì—ì„œ ì´ëŸ¬ë©´ ëŒ€í™”ê°€ ì—‰ë§ì´ ë¨
```

### Consumer â€” "ìš°ì²´êµ­ì—ì„œ í¸ì§€ ìˆ˜ë ¹"

```java
// Consumer Group 1: DBì— ì €ì¥í•˜ëŠ” íŒ€
@KafkaListener(topics = "chat.messages", containerFactory = "persistenceListenerFactory")
@Transactional
public void consume(ConsumerRecord<String, ChatMessageEvent> record, Acknowledgment ack) {
    ChatMessageEvent event = record.value();  // í¸ì§€ ë‚´ìš© êº¼ë‚´ê¸°

    // 1. ì´ë¯¸ ì €ì¥í•œ ë©”ì‹œì§€ì¸ì§€ í™•ì¸ (ë©±ë“±ì„±!)
    if (messageRepository.existsByMessageKey(event.getMessageKey())) {
        ack.acknowledge();  // "ì´ë¯¸ ì²˜ë¦¬í–ˆì–´, ë‹¤ìŒ í¸ì§€ ì¤˜"
        return;             // ì €ì¥í•˜ì§€ ì•Šê³  ë„˜ì–´ê°
    }

    // 2. DBì— ì €ì¥
    Message message = new Message(event.getMessageKey(), room, sender, ...);
    messageRepository.save(message);

    // 3. ê°™ì€ ë°©ì˜ ë‹¤ë¥¸ ë©¤ë²„ë“¤ì˜ ì•ˆì½ì€ ìˆ˜ +1
    chatRoomMemberRepository.incrementUnreadCountForOtherMembers(roomId, senderId);

    // 4. ëª¨ë“  ì²˜ë¦¬ê°€ ëë‚œ í›„ì—ë§Œ! "ë°›ì•˜ì–´!" í™•ì¸
    ack.acknowledge();
}
```

**`@Transactional`ì´ ì™œ í•„ìš”í•´?**

```
ë¹„ìœ : ì€í–‰ ê³„ì¢Œì´ì²´

A ê³„ì¢Œì—ì„œ 100ë§Œì› ì¶œê¸ˆ â†’ B ê³„ì¢Œì— 100ë§Œì› ì…ê¸ˆ

ë§Œì•½ ì¶œê¸ˆì€ ëëŠ”ë° ì…ê¸ˆ ì „ì— ì‹œìŠ¤í…œ ì—ëŸ¬ê°€ ë‚˜ë©´?
â†’ A: -100ë§Œì›, B: +0ì› â†’ 100ë§Œì›ì´ ì¦ë°œ!

@Transactionalì˜ ì—­í• :
â†’ ì¶œê¸ˆê³¼ ì…ê¸ˆì„ "í•˜ë‚˜ì˜ ë¬¶ìŒ"ìœ¼ë¡œ ì²˜ë¦¬
â†’ ë‘˜ ë‹¤ ì„±ê³µí•´ì•¼ ìµœì¢… ë°˜ì˜ (ì»¤ë°‹)
â†’ í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ì „ë¶€ ì·¨ì†Œ (ë¡¤ë°±)

ìš°ë¦¬ ì½”ë“œì—ì„œ:
1. ë©”ì‹œì§€ DB ì €ì¥ (INSERT INTO messages)
2. ì•ˆì½ì€ ìˆ˜ ì¦ê°€ (UPDATE chat_room_members)
â†’ 1ì€ ì„±ê³µ, 2ê°€ ì‹¤íŒ¨? â†’ 1ë„ ì·¨ì†Œ! ë°ì´í„° ì¼ê´€ì„± ìœ ì§€!
```

---

## 9. STEP 6: WebSocket + Redis

### ë©”ì‹œì§€ ì „ì†¡ â€” "ì¹´ì¹´ì˜¤í†¡ ë³´ë‚´ê¸° ë²„íŠ¼ ëˆ„ë¥´ë©´"

```java
// í´ë¼ì´ì–¸íŠ¸ê°€ /app/chat.sendë¡œ ë³´ë‚¸ ë©”ì‹œì§€ë¥¼ ì—¬ê¸°ì„œ ë°›ìŒ
@MessageMapping("/chat.send")
public void sendMessage(@Payload SendMessageRequest request, Principal principal) {
    Long userId = Long.parseLong(principal.getName());

    // ì´ ë°©ì˜ ë©¤ë²„ê°€ ë§ëŠ”ì§€ í™•ì¸
    if (!chatRoomMemberRepository.existsByChatRoomIdAndUserId(request.getRoomId(), userId)) {
        throw new BusinessException("ì±„íŒ…ë°©ì— ì°¸ì—¬í•˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤.");
    }

    // Kafkaì— ë©”ì‹œì§€ ì ‘ìˆ˜ (ì—¬ê¸°ì„œ ë°”ë¡œ ìƒëŒ€ë°©ì—ê²Œ ë³´ë‚´ì§€ ì•ŠìŒ!)
    ChatMessageEvent event = ChatMessageEvent.of(
            request.getRoomId(), userId, sender.getNickname(),
            request.getContent(), request.getType()
    );
    chatMessageProducer.sendMessage(event);  // â†’ Kafka ìš°ì²´êµ­ìœ¼ë¡œ!
}
```

```
"ì™œ ë°”ë¡œ ì•ˆ ë³´ë‚´ê³  Kafkaë¥¼ ê±°ì³?"

[ë°”ë¡œ ë³´ë‚´ëŠ” ë°©ì‹]
ì‚¬ìš©ìA â†’ ì„œë²„ â†’ ë°”ë¡œ ì‚¬ìš©ìBì—ê²Œ ì „ë‹¬ + ë³„ë„ë¡œ DB ì €ì¥
ë¬¸ì œ 1: DB ì €ì¥ ì‹¤íŒ¨í•˜ë©´? ë©”ì‹œì§€ê°€ ì‚¬ë¼ì§!
ë¬¸ì œ 2: ì„œë²„ 2ëŒ€ë©´? AëŠ” ì„œë²„1, BëŠ” ì„œë²„2 â†’ ì„œë²„1ì´ Bì—ê²Œ ëª» ë³´ëƒ„!

[Kafka ê²½ìœ  ë°©ì‹ â€” ìš°ë¦¬ ì„ íƒ]
ì‚¬ìš©ìA â†’ ì„œë²„ â†’ Kafka â†’ Consumer1(DB ì €ì¥) + Consumer2(ì „ë‹¬)
ì¥ì  1: Kafkaê°€ ë©”ì‹œì§€ë¥¼ ì•ˆì „í•˜ê²Œ ë³´ê´€, ì‹¤íŒ¨í•´ë„ ì¬ì‹œë„ ê°€ëŠ¥
ì¥ì  2: ì„œë²„ê°€ ëª‡ ëŒ€ë“  Consumerê°€ ì•Œì•„ì„œ ì²˜ë¦¬
ì¥ì  3: ì €ì¥ê³¼ ì „ë‹¬ì´ ë…ë¦½ì  â†’ í•˜ë‚˜ê°€ ëŠë ¤ë„ ë‹¤ë¥¸ ê²ƒì— ì˜í–¥ ì—†ìŒ

ë‹¨ì : ëª‡ ë°€ë¦¬ì´ˆ(0.00xì´ˆ) ì§€ì—° â†’ ì‚¬ëŒì€ ê°ì§€ ë¶ˆê°€
```

### Redis Pub/Sub â€” "ì‚¬ë‚´ ë°©ì†¡"

```java
// Kafka Consumer 2ê°€ Redisë¡œ ë°©ì†¡
public void publish(ChatMessageEvent event) {
    String channel = "chat:room:" + event.getRoomId();   // "chat:room:1"
    String message = objectMapper.writeValueAsString(event);  // JSONìœ¼ë¡œ ë³€í™˜
    redisTemplate.convertAndSend(channel, message);  // ë°©ì†¡!
}

// ëª¨ë“  ì„œë²„ê°€ ë°©ì†¡ì„ ìˆ˜ì‹ 
public void onMessage(String message, String channel) {
    ChatMessageEvent event = objectMapper.readValue(message, ChatMessageEvent.class);
    String roomId = channel.replace("chat:room:", "");
    messagingTemplate.convertAndSend("/topic/room." + roomId, event);
    // â†‘ ì´ ì„œë²„ì—ì„œ 1ë²ˆ ë°©ì„ êµ¬ë… ì¤‘ì¸ ëª¨ë“  WebSocket í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬!
}
```

```
ì„œë²„ 2ëŒ€ì¼ ë•Œ ì–´ë–»ê²Œ ë™ì‘í•´?

[ì„œë²„ 1]                              [ì„œë²„ 2]
ì‚¬ìš©ì A, C ì—°ê²°                       ì‚¬ìš©ì B, D ì—°ê²°

1. ì‚¬ìš©ì Aê°€ 1ë²ˆ ë°©ì— "ì•ˆë…•" ì „ì†¡
2. ì„œë²„1 â†’ Kafka â†’ Consumer2 â†’ Redis ë°©ì†¡: "chat:room:1ì— ìƒˆ ë©”ì‹œì§€!"

3. ì„œë²„1: ë°©ì†¡ ë“¤ìŒ â†’ "ë‚˜í•œí…Œ ì—°ê²°ëœ ì‚¬ìš©ì ì¤‘ 1ë²ˆ ë°© êµ¬ë…ì?"
   â†’ ì‚¬ìš©ì A, C ì¤‘ 1ë²ˆ ë°© êµ¬ë…ìì—ê²Œ ì „ë‹¬

4. ì„œë²„2: ë°©ì†¡ ë“¤ìŒ â†’ "ë‚˜í•œí…Œ ì—°ê²°ëœ ì‚¬ìš©ì ì¤‘ 1ë²ˆ ë°© êµ¬ë…ì?"
   â†’ ì‚¬ìš©ì B, D ì¤‘ 1ë²ˆ ë°© êµ¬ë…ìì—ê²Œ ì „ë‹¬

â†’ ì–´ëŠ ì„œë²„ì— ì—°ê²°ë˜ì–´ ìˆë“  ë©”ì‹œì§€ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ!
```

---

## 10. STEP 7: ë©”ì‹œì§€ ì´ë ¥ + ì½ìŒ í‘œì‹œ

### ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§€ë„¤ì´ì…˜ â€” "ì¸ìŠ¤íƒ€ê·¸ë¨ ìŠ¤í¬ë¡¤"

ì±„íŒ…ë°©ì— ë©”ì‹œì§€ê°€ 10,000ê°œë©´ í•œ ë²ˆì— ë‹¤ ë³´ì—¬ì¤„ ìˆ˜ ì—†ê² ì£ ?
20ê°œì”© ë‚˜ëˆ ì„œ ë³´ì—¬ì¤˜ì•¼ í•©ë‹ˆë‹¤.

```
[ì˜ëª»ëœ ë°©ë²• â€” Offset]
"20ë²ˆì§¸ë¶€í„° 20ê°œ ë³´ì—¬ì¤˜"

  ë©”ì‹œì§€: [1] [2] [3] ... [20] [21] [22] ... [40] [41] ...
  1í˜ì´ì§€: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  2í˜ì´ì§€:                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ë¬¸ì œ: 1í˜ì´ì§€ë¥¼ ë³´ëŠ” ë™ì•ˆ ìƒˆ ë©”ì‹œì§€ 3ê°œê°€ ì¶”ê°€ë˜ë©´?
  [ìƒˆ1] [ìƒˆ2] [ìƒˆ3] [1] [2] [3] ... [20] [21] ...

  2í˜ì´ì§€ì—ì„œ "20ë²ˆì§¸ë¶€í„°" í•˜ë©´:
  [18] [19] [20] â†’ 1í˜ì´ì§€ì—ì„œ ë³¸ ë©”ì‹œì§€ê°€ ë˜ ë‚˜ì˜´! (ì¤‘ë³µ!)

[ì˜¬ë°”ë¥¸ ë°©ë²• â€” Cursor (ìš°ë¦¬ ì„ íƒ)]
"id=20ë³´ë‹¤ ì´ì „ ê²ƒ 20ê°œ ë³´ì—¬ì¤˜"

  ë©”ì‹œì§€: [1] [2] [3] ... [20] [21] [22] ... [40]
  1í˜ì´ì§€: "ìµœì‹  20ê°œ" â†’ [21]~[40]
  2í˜ì´ì§€: "id=21ë³´ë‹¤ ì´ì „ ê²ƒ 20ê°œ" â†’ [1]~[20]

  ìƒˆ ë©”ì‹œì§€ê°€ ì¶”ê°€ë˜ì–´ë„: [ìƒˆ1] [ìƒˆ2] [ìƒˆ3] [1] ... [40]
  "id=21ë³´ë‹¤ ì´ì „ ê²ƒ" â†’ ì—¬ì „íˆ [1]~[20] (ì˜í–¥ ì—†ìŒ!)
```

```java
// "size+1ê°œ ì¡°íšŒ" íŠ¸ë¦­
public MessagePageResponse getMessages(Long roomId, Long cursor, int size) {
    int fetchSize = size + 1;  // 20ê°œ ìš”ì²­í–ˆìœ¼ë©´ 21ê°œ ì¡°íšŒ!

    List<Message> messages = messageRepository.findByRoomIdWithCursor(roomId, cursor, fetchSize);

    boolean hasMore = messages.size() > size;  // 21ê°œ ì™”ìœ¼ë©´ â†’ ë” ìˆë‹¤!
    if (hasMore) {
        messages = messages.subList(0, size);  // 21ê°œ ì¤‘ 20ê°œë§Œ ë°˜í™˜
    }

    // ì‘ë‹µ: { messages: [...20ê°œ...], hasMore: true, nextCursor: 21 }
}
```

```
ì™œ 21ê°œë¥¼ ì¡°íšŒí•´ì„œ 20ê°œë§Œ ë³´ì—¬ì£¼ë‚˜?

"ë” ìˆëŠ”ì§€" ì•Œë ¤ë©´ ì¶”ê°€ ì¿¼ë¦¬ê°€ í•„ìš”:
â†’ SELECT COUNT(*) FROM messages WHERE ... â†’ ëŠë¦´ ìˆ˜ ìˆìŒ!

21ê°œ íŠ¸ë¦­:
â†’ 21ê°œ ì™”ìœ¼ë©´ "ì ì–´ë„ 1ê°œ ë” ìˆë‹¤!" â†’ hasMore: true
â†’ 15ê°œ ì™”ìœ¼ë©´ "ì´ê²Œ ëì´ë‹¤!" â†’ hasMore: false
â†’ ì¶”ê°€ ì¿¼ë¦¬ ì—†ì´ íŒë‹¨ ê°€ëŠ¥! (ë¹ ë¦„!)
```

### ì½ìŒ ì²˜ë¦¬ â€” "ì¹´ì¹´ì˜¤í†¡ì˜ ìˆ«ì 1"

```
ì¹´ì¹´ì˜¤í†¡ì—ì„œ "1"ì´ ëœ¨ëŠ” ì›ë¦¬:

1. Aê°€ Bì—ê²Œ "ì•ˆë…•" ì „ì†¡
2. Bì˜ ì±„íŒ…ë°©ì— "ì•ˆì½ì€ ë©”ì‹œì§€: 1" í‘œì‹œ
3. Bê°€ ì±„íŒ…ë°© ì…ì¥ â†’ "ì—¬ê¸°ê¹Œì§€ ì½ì—ˆì–´!" ì„œë²„ì— ì•Œë¦¼
4. ì„œë²„: Bì˜ unread_countë¥¼ 0ìœ¼ë¡œ ì—…ë°ì´íŠ¸
5. Aì—ê²Œë„ "Bê°€ ì½ì—ˆì–´!" ì•Œë¦¼ (ìš°ë¦¬ëŠ” ì—¬ê¸°ê¹Œì§€ êµ¬í˜„ ì•ˆ í•¨)
```

```java
// ì½ìŒ ì²˜ë¦¬ íë¦„
public void processReadReceipt(ReadReceiptEvent event) {
    ChatRoomMember member = chatRoomMemberRepository
            .findByChatRoomIdAndUserId(event.getRoomId(), event.getUserId());

    // "ë’¤ë¡œ ê°€ê¸°" ë°©ì§€: ë” ìµœì‹  ë©”ì‹œì§€ê¹Œì§€ ì½ì€ ê²½ìš°ë§Œ ì—…ë°ì´íŠ¸
    if (member.getLastReadMessageId() < event.getLastReadMessageId()) {
        member.updateLastReadMessageId(event.getLastReadMessageId());

        // DBì—ì„œ ì‹¤ì œ ì•ˆì½ì€ ìˆ˜ ì¬ê³„ì‚°
        int unreadCount = messageRepository.countUnreadMessages(roomId, lastReadMessageId);
        member.updateUnreadCount(unreadCount);

        // Redis ìºì‹œë„ ì—…ë°ì´íŠ¸ (ë‹¤ìŒì— ë¹ ë¥´ê²Œ ì¡°íšŒí•˜ë ¤ê³ )
        redisTemplate.opsForValue().set(key, String.valueOf(unreadCount));
    }
}

// ì•ˆì½ì€ ìˆ˜ ì¡°íšŒ: Redis â†’ DB fallback
public int getUnreadCount(Long roomId, Long userId) {
    String cached = redisTemplate.opsForValue().get(key);
    if (cached != null) return Integer.parseInt(cached);
    // â†‘ Redisì— ìˆìœ¼ë©´ ë°”ë¡œ ë°˜í™˜ (0.001ì´ˆ)

    // Redisì— ì—†ìœ¼ë©´ DBì—ì„œ ì¡°íšŒ (0.01ì´ˆ)
    ChatRoomMember member = chatRoomMemberRepository.findByChatRoomIdAndUserId(...);
    int unreadCount = member.getUnreadCount();
    redisTemplate.opsForValue().set(key, String.valueOf(unreadCount));
    // â†‘ ë‹¤ìŒì—ëŠ” Redisì—ì„œ ë°”ë¡œ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ì €ì¥
    return unreadCount;
}
```

```
Redis ìºì‹œ + DB fallback íŒ¨í„´:

ë¹„ìœ : í¬ìŠ¤íŠ¸ì‡ + ì„œë¥˜ ìºë¹„ë‹›

"ì´ ê³ ê° ì „í™”ë²ˆí˜¸ ë­ì˜€ì§€?"
1ë‹¨ê³„: ëª¨ë‹ˆí„° ì˜† í¬ìŠ¤íŠ¸ì‡ í™•ì¸ (Redis) â†’ ìˆìœ¼ë©´ ë°”ë¡œ ë‹µë³€! (ë¹ ë¦„)
2ë‹¨ê³„: ì—†ìœ¼ë©´ ì„œë¥˜ ìºë¹„ë‹› ë’¤ì ¸ì„œ ì°¾ê¸° (DB) â†’ ì°¾ìœ¼ë©´ í¬ìŠ¤íŠ¸ì‡ì— ì ì–´ë‘ 
â†’ ë‹¤ìŒì— ë˜ ë¬¼ì–´ë³´ë©´ í¬ìŠ¤íŠ¸ì‡ì—ì„œ ë°”ë¡œ!

Redisê°€ êº¼ì§€ë©´? â†’ ì„œë¥˜ ìºë¹„ë‹›(DB)ì— ì›ë³¸ì´ ìˆìœ¼ë‹ˆê¹Œ ê´œì°®ìŒ!
â†’ RedisëŠ” "ìˆìœ¼ë©´ ì¢‹ê³ , ì—†ì–´ë„ ì„œë¹„ìŠ¤ ê°€ëŠ¥"
```

---

## 11. STEP 8: í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ê°€ ì™œ í•„ìš”í•´?

```
ë¹„ìœ : ìë™ì°¨ ì¶œê³  ì „ ê²€ì‚¬

ìë™ì°¨ ê³µì¥ì—ì„œ ì°¨ë¥¼ ë§Œë“¤ì—ˆì–´ìš”.
"ì˜ ë§Œë“  ê²ƒ ê°™ì€ë°... ë°”ë¡œ íŒ”ì!" â†’ ë¸Œë ˆì´í¬ê°€ ì•ˆ ë˜ë©´?!

ë°˜ë“œì‹œ ê²€ì‚¬í•´ì•¼ í•¨:
âœ… ì—”ì§„ ì‹œë™ì´ ê±¸ë¦¬ëŠ”ì§€ (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)
âœ… ë„ë¡œì—ì„œ ì‹¤ì œë¡œ ë‹¬ë¦¬ëŠ”ì§€ (í†µí•© í…ŒìŠ¤íŠ¸)
âœ… ë¸Œë ˆì´í¬ê°€ ì‘ë™í•˜ëŠ”ì§€ (ì—ëŸ¬ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸)

ì½”ë“œë„ ë§ˆì°¬ê°€ì§€:
âœ… íšŒì›ê°€ì…ì´ ë˜ëŠ”ì§€
âœ… ë¡œê·¸ì¸í•˜ë©´ í† í°ì´ ë‚˜ì˜¤ëŠ”ì§€
âœ… ì¤‘ë³µ ì´ë©”ì¼ì€ ê±°ë¶€ë˜ëŠ”ì§€
âœ… í† í° ì—†ì´ API í˜¸ì¶œí•˜ë©´ 401ì´ ë‚˜ì˜¤ëŠ”ì§€
```

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ vs í†µí•© í…ŒìŠ¤íŠ¸

```
[ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ â€” ë¶€í’ˆ í•˜ë‚˜ë§Œ ê²€ì‚¬]

"AuthServiceì˜ íšŒì›ê°€ì… ë¡œì§ë§Œ í…ŒìŠ¤íŠ¸"
â†’ ì§„ì§œ DB ì•ˆ ì“°ê³ , ê°€ì§œ(Mock) DB ì‚¬ìš©
â†’ 0.1ì´ˆ ë§Œì— ì‹¤í–‰
â†’ "ì´ë©”ì¼ ì¤‘ë³µì´ë©´ ì—ëŸ¬ê°€ ë‚˜ëŠ”ì§€?" ê°™ì€ ê²ƒë§Œ í™•ì¸

ë¹„ìœ : ìë™ì°¨ ì—”ì§„ë§Œ ë”°ë¡œ êº¼ë‚´ì„œ í…ŒìŠ¤íŠ¸
â†’ ì°¨ì— ì•ˆ ë‹¬ì•„ë„ ì—”ì§„ ì‘ë™ í™•ì¸ ê°€ëŠ¥

[í†µí•© í…ŒìŠ¤íŠ¸ â€” ì „ì²´ ì¡°ë¦½ í›„ ê²€ì‚¬]

"ì§„ì§œ HTTP ìš”ì²­ â†’ ì§„ì§œ DB â†’ ì§„ì§œ Kafka â†’ ê²°ê³¼ í™•ì¸"
â†’ Testcontainersë¡œ PostgreSQL, Kafka, Redisë¥¼ ì§„ì§œë¡œ ì‹¤í–‰
â†’ 30ì´ˆ ê±¸ë¦¼
â†’ "íšŒì›ê°€ì… â†’ ë¡œê·¸ì¸ â†’ ì±„íŒ…ë°© ìƒì„±" ì „ì²´ íë¦„ í™•ì¸

ë¹„ìœ : ì™„ì„±ëœ ìë™ì°¨ë¥¼ ë„ë¡œì—ì„œ ì‹œìš´ì „
â†’ ì—”ì§„, ë°”í€´, ë¸Œë ˆì´í¬ ë“± ëª¨ë“  ë¶€í’ˆì´ í•¨ê»˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸
```

```java
// í†µí•© í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ (ì‹¤ì œ ì½”ë“œ!)
@Test
void íšŒì›ê°€ì…_ë¡œê·¸ì¸_í† í°ì¸ì¦_ì „ì²´íë¦„() {
    // 1. ì§„ì§œ HTTPë¡œ íšŒì›ê°€ì…
    ResponseEntity<AuthResponse> signup = restTemplate.postForEntity(
            "/api/auth/signup", signupRequest, AuthResponse.class);
    assertThat(signup.getStatusCode()).isEqualTo(CREATED);  // 201ì´ ì™€ì•¼ í•¨!

    // 2. ì§„ì§œ HTTPë¡œ ë¡œê·¸ì¸
    ResponseEntity<AuthResponse> login = restTemplate.postForEntity(
            "/api/auth/login", loginRequest, AuthResponse.class);
    assertThat(login.getBody().getToken()).isNotBlank();  // í† í°ì´ ìˆì–´ì•¼ í•¨!

    // 3. í† í°ìœ¼ë¡œ ë³´í˜¸ëœ API ì ‘ê·¼
    headers.setBearerAuth(login.getBody().getToken());
    ResponseEntity<String> rooms = restTemplate.exchange(
            "/api/rooms", GET, new HttpEntity<>(headers), String.class);
    assertThat(rooms.getStatusCode()).isEqualTo(OK);  // 200ì´ ì™€ì•¼ í•¨!

    // 4. í† í° ì—†ì´ ì ‘ê·¼ â†’ ê±°ë¶€ë˜ì–´ì•¼ í•¨!
    ResponseEntity<String> unauthorized = restTemplate.getForEntity("/api/rooms", String.class);
    assertThat(unauthorized.getStatusCode()).isIn(UNAUTHORIZED, FORBIDDEN);  // 401 or 403!
}
```

---

## 12. ë©”ì‹œì§€ ì—¬í–‰ê¸°

ì‚¬ìš©ì ì² ìˆ˜ê°€ 1ë²ˆ ì±„íŒ…ë°©ì— **"ì•ˆë…•"**ì´ë¼ê³  ë³´ë‚´ë©´, ì´ ë©”ì‹œì§€ëŠ” ì–´ë–¤ ì—¬í–‰ì„ í• ê¹Œìš”?

```
ğŸš€ "ì•ˆë…•"ì˜ ì—¬ì •

[ì¶œë°œ] ì² ìˆ˜ì˜ í°
  â”‚
  â”‚  STOMP í”„ë ˆì„: SEND /app/chat.send {"roomId":1, "content":"ì•ˆë…•"}
  â”‚  í—¤ë”: Authorization: Bearer eyJ... (JWT í† í°)
  â”‚
  â–¼
[ì •ë¥˜ì¥ 1] WebSocketAuthInterceptor
  â”‚  "JWT í† í° í™•ì¸... userId=1, OK! í†µê³¼!"
  â”‚
  â–¼
[ì •ë¥˜ì¥ 2] ChatMessageController
  â”‚  "1ë²ˆ ë°© ë©¤ë²„ ë§ëŠ”ì§€ í™•ì¸... OK!"
  â”‚  ChatMessageEvent ìƒì„±:
  â”‚  { messageKey: UUID, roomId: 1, senderId: 1,
  â”‚    senderNickname: "ì² ìˆ˜", content: "ì•ˆë…•", type: TEXT }
  â”‚
  â–¼
[ì •ë¥˜ì¥ 3] ChatMessageProducer
  â”‚  kafkaTemplate.send("chat.messages", key="1", event)
  â”‚  "Kafka ìš°ì²´êµ­ì— ì ‘ìˆ˜ ì™„ë£Œ!"
  â”‚  â†’ Partition key = "1" â†’ hash("1") % 6 = 3 â†’ íŒŒí‹°ì…˜ 3ì— ì €ì¥
  â”‚
  â–¼
[ì •ë¥˜ì¥ 4] Kafka
  â”‚  chat.messages í† í”½, íŒŒí‹°ì…˜ 3, offset 42ì— ê¸°ë¡
  â”‚
  â”‚  2ê°œ íŒ€ì´ ê°ê° ìˆ˜ë ¹:
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                  â”‚
  â–¼                                  â–¼
[ì •ë¥˜ì¥ 5-A]                    [ì •ë¥˜ì¥ 5-B]
MessagePersistenceConsumer      MessageBroadcastConsumer
  â”‚                                  â”‚
  â”‚ "messageKey ì´ë¯¸ ìˆì–´?"           â”‚ "Redisë¡œ ë°©ì†¡!"
  â”‚ â†’ ì—†ìŒ â†’ DBì— ì €ì¥!             â”‚ â†’ PUBLISH "chat:room:1"
  â”‚ â†’ unreadCount +1                â”‚
  â”‚ â†’ ack (ì²˜ë¦¬ ì™„ë£Œ!)              â”‚ â†’ ack (ì²˜ë¦¬ ì™„ë£Œ!)
  â”‚                                  â”‚
  â”‚                                  â–¼
  â”‚                            [ì •ë¥˜ì¥ 6] Redis Pub/Sub
  â”‚                                  â”‚
  â”‚                            "chat:room:1" ì±„ë„ì— ë°©ì†¡!
  â”‚                                  â”‚
  â”‚                            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
  â”‚                            â–¼           â–¼
  â”‚                       [ì„œë²„ 1]     [ì„œë²„ 2]
  â”‚                      onMessage()  onMessage()
  â”‚                            â”‚           â”‚
  â”‚                            â–¼           â–¼
  â”‚                     STOMP SEND    STOMP SEND
  â”‚                     /topic/room.1 /topic/room.1
  â”‚                            â”‚           â”‚
  â”‚                            â–¼           â–¼
  â”‚                        [ì˜í¬]       [ë¯¼ìˆ˜]
  â”‚                       "ì•ˆë…•" ìˆ˜ì‹   "ì•ˆë…•" ìˆ˜ì‹ 
  â”‚
  â–¼
[ë„ì°©] DBì— ì˜êµ¬ ì €ì¥ ì™„ë£Œ
  â†’ ì˜í¬ê°€ ë‚˜ì¤‘ì— ì•±ì„ ì—´ë©´ GET /api/rooms/1/messagesë¡œ ì¡°íšŒ ê°€ëŠ¥
```

---

# Part 3: 2ì°¨ êµ¬í˜„ (í”„ë¡œë•ì…˜ í’ˆì§ˆ) â€” ì§„ì§œ ì„œë¹„ìŠ¤ì²˜ëŸ¼ ë§Œë“¤ê¸°

> 1ì°¨ì—ì„œëŠ” **"ë™ì‘í•˜ëŠ” ì±„íŒ…"**ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.
> 2ì°¨ì—ì„œëŠ” **"ì‹¤ì œ ì„œë¹„ìŠ¤ë¡œ ìš´ì˜í•  ìˆ˜ ìˆëŠ” ì±„íŒ…"**ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí•©ë‹ˆë‹¤.
>
> ë¹„ìœ : 1ì°¨ = ì‹œí—˜ ì£¼í–‰ ì„±ê³µ, 2ì°¨ = ì•ˆì „ë²¨íŠ¸, ì—ì–´ë°±, ì†ë„ ì œí•œê¸°, ê³„ê¸°íŒ ì¥ì°©

---

## 13. STEP 9: ê±´ê°• ê²€ì§„ + ìš°ì•„í•œ í‡´ì¥

### Health Check â€” "ì„œë²„ì•¼, ë„ˆ ê´œì°®ì•„?"

```
ë¹„ìœ : ë³‘ì› ê±´ê°• ê²€ì§„

ì‚¬ì¥ë‹˜: "ì§ì›ë“¤ ê±´ê°• ê²€ì§„ ë°›ì•„ì•¼ì§€"
â†’ í˜ˆì•• ì²´í¬ (DB ì—°ê²° ì •ìƒ?)
â†’ ì‹¬ì „ë„ (Kafka ì—°ê²° ì •ìƒ?)
â†’ í˜ˆì•¡ ê²€ì‚¬ (Redis ì—°ê²° ì •ìƒ?)
â†’ ëª¨ë‘ ì •ìƒ! â†’ "ì´ ì§ì› ê±´ê°•í•©ë‹ˆë‹¤" (UP)
â†’ í•˜ë‚˜ë¼ë„ ì´ìƒ! â†’ "ì´ ì§ì› ì‰¬ê²Œ í•´ì£¼ì„¸ìš”" (DOWN)
```

```
ì‹¤ì œë¡œ GET /actuator/healthë¥¼ í˜¸ì¶œí•˜ë©´:

{
  "status": "UP",                    â† ì „ì²´: ê±´ê°•!
  "components": {
    "db": { "status": "UP" },        â† DB: ì •ìƒ
    "kafka": { "status": "UP" },     â† Kafka: ì •ìƒ
    "redis": { "status": "UP" },     â† Redis: ì •ìƒ
    "diskSpace": { "status": "UP" }  â† ë””ìŠ¤í¬ ê³µê°„: ì¶©ë¶„
  }
}
```

**ì´ê±¸ ëˆ„ê°€, ì™œ í™•ì¸í•´?**

```
[ë¡œë“œ ë°¸ëŸ°ì„œê°€ í™•ì¸]

ë¡œë“œ ë°¸ëŸ°ì„œ = êµí†µ ê²½ì°°
"ì„œë²„ 1, 2, 3 ì¤‘ì— ì–´ë””ë¡œ ë³´ë‚´ì§€?"

ë§¤ 5ì´ˆë§ˆë‹¤:
â†’ ì„œë²„1 /actuator/health â†’ UP â†’ ìš”ì²­ ë³´ë‚´ë„ ë¨!
â†’ ì„œë²„2 /actuator/health â†’ DOWN â†’ ì´ ì„œë²„ë¡œ ë³´ë‚´ë©´ ì•ˆ ë¼!
â†’ ì„œë²„3 /actuator/health â†’ UP â†’ ìš”ì²­ ë³´ë‚´ë„ ë¨!

ê²°ê³¼: ì„œë²„2ê°€ ì•„í”„ë©´ ìë™ìœ¼ë¡œ ì„œë²„1, 3ì—ë§Œ ìš”ì²­ ë¶„ë°°
â†’ ì‚¬ìš©ìëŠ” ì„œë²„2ê°€ ì•„í”ˆì§€ë„ ëª¨ë¦„!

[Kubernetesê°€ í™•ì¸]

K8s: "ì„œë²„2ê°€ ì‘ë‹µ ì—†ì–´? ìë™ìœ¼ë¡œ ìƒˆ ì„œë²„ ë„ì›Œì¤„ê²Œ!"
â†’ ì„œë²„ê°€ ì£½ìœ¼ë©´ ìë™ìœ¼ë¡œ ìƒˆ ì„œë²„ ìƒì„± (ìê°€ ì¹˜ìœ )
```

### Graceful Shutdown â€” "í‡´ê·¼ ì˜ˆì ˆ"

```
[ë‚˜ìœ í‡´ê·¼ â€” ê·¸ëƒ¥ ì»´í“¨í„° ë„ê¸°]

5ì‹œ ë•¡! â†’ ë°”ë¡œ ì „ì› OFF
â†’ ì‘ì„± ì¤‘ì´ë˜ ë¬¸ì„œ: ì €ì¥ ì•ˆ ë¨! ë‚ ì•„ê°!
â†’ ì²˜ë¦¬ ì¤‘ì´ë˜ ì´ë©”ì¼: ì ˆë°˜ë§Œ ë³´ë‚´ì§!
â†’ ë°ì´í„°ë² ì´ìŠ¤: íŠ¸ëœì­ì…˜ ê¹¨ì§!

[ì¢‹ì€ í‡´ê·¼ â€” Graceful Shutdown]

5ì‹œ ë•¡! â†’
1. "ìƒˆë¡œìš´ ì—…ë¬´ëŠ” ì•ˆ ë°›ê² ìŠµë‹ˆë‹¤" (ìƒˆ ìš”ì²­ ê±°ë¶€)
2. "ì§€ê¸ˆ í•˜ê³  ìˆëŠ” ì—…ë¬´ë§Œ ë§ˆë¬´ë¦¬í• ê²Œìš”" (ì§„í–‰ ì¤‘ì¸ ìš”ì²­ ì™„ë£Œ ëŒ€ê¸°)
3. "Kafkaì— 'ì—¬ê¸°ê¹Œì§€ ì²˜ë¦¬í–ˆì–´' ê¸°ë¡í•©ë‹ˆë‹¤" (offset ì»¤ë°‹)
4. "DB ì—°ê²° ì •ë¦¬í•©ë‹ˆë‹¤" (ì»¤ë„¥ì…˜ í’€ ë°˜í™˜)
5. ê¹”ë”í•˜ê²Œ í‡´ê·¼! (í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ)

ìµœëŒ€ ëŒ€ê¸° ì‹œê°„: 30ì´ˆ (ì´ ì•ˆì— ë§ˆë¬´ë¦¬ ì•ˆ ë˜ë©´ ê°•ì œ ì¢…ë£Œ)
```

```yaml
# application.yml ì„¤ì •
server:
  shutdown: graceful              # "ìš°ì•„í•˜ê²Œ ì¢…ë£Œí•´ì¤˜"

spring:
  lifecycle:
    timeout-per-shutdown-phase: 30s  # "ìµœëŒ€ 30ì´ˆê¹Œì§€ ê¸°ë‹¤ë ¤ì¤„ê²Œ"

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics  # ì´ 3ê°œ APIë¥¼ ì—´ì–´ì¤˜
  endpoint:
    health:
      show-details: always  # DB, Kafka, Redis ìƒíƒœë„ ë³´ì—¬ì¤˜
```

```java
// SecurityConfig.java â€” Health CheckëŠ” ë¡œê·¸ì¸ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ
.authorizeHttpRequests(auth -> auth
        .requestMatchers("/api/auth/**").permitAll()
        .requestMatchers("/ws/**").permitAll()
        .requestMatchers("/actuator/health/**").permitAll()  // â† ì¶”ê°€!
        // ë¡œë“œ ë°¸ëŸ°ì„œëŠ” JWT í† í°ì´ ì—†ìœ¼ë‹ˆê¹Œ permitAll í•´ì¤˜ì•¼ í•¨
        .anyRequest().authenticated())
```

---

## 14. STEP 10: ë„ë°° ë°©ì§€

### ì™œ í•„ìš”í•´?

```
ë¹„ìœ : êµì‹¤ì—ì„œ í•œ í•™ìƒì´ 1ë¶„ì— 100ë²ˆ ì†ì„ ë“¤ë©´?

ì„ ìƒë‹˜ì´ ë‹¤ë¥¸ í•™ìƒì˜ ì§ˆë¬¸ì„ ëª» ë°›ìŒ!
â†’ "ì† ë“¤ê¸° 1ë¶„ì— 10ë²ˆê¹Œì§€ë§Œ!" ê·œì¹™ í•„ìš”

ì±„íŒ…ì—ì„œ:
â†’ ëˆ„êµ°ê°€ 1ì´ˆì— 1,000ê°œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´?
â†’ Kafkaì— ë©”ì‹œì§€ í­íƒ„ â†’ ì „ì²´ ì„œë¹„ìŠ¤ ëŠë ¤ì§
â†’ "1ì´ˆì— 10ê°œê¹Œì§€ë§Œ!" ê·œì¹™ í•„ìš” (ì‚¬ëŒì€ ì ˆëŒ€ 1ì´ˆì— 10ê°œ ëª» ì¹¨)
```

### ì–´ë–»ê²Œ ë™ì‘í•´?

```
[ìœ ì €ë³„ ì¹´ìš´í„°]

ìœ ì €1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  (8/10) â†’ ì•„ì§ ê´œì°®ì•„, ë³´ë‚´ë„ ë¨
ìœ ì €2: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  (10/10) â†’ í•œê³„! ë‹¤ìŒ ë©”ì‹œì§€ë¶€í„° ì°¨ë‹¨!
ìœ ì €3: â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  (2/10) â†’ ì—¬ìœ  ìˆìŒ

1ì´ˆê°€ ì§€ë‚˜ë©´? â†’ ëª¨ë“  ì¹´ìš´í„° ë¦¬ì…‹!
ìœ ì €1: â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  (0/10) â†’ ë‹¤ì‹œ ë³´ë‚¼ ìˆ˜ ìˆìŒ
ìœ ì €2: â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  (0/10) â†’ ë‹¤ì‹œ ë³´ë‚¼ ìˆ˜ ìˆìŒ
```

```java
// RateLimitInterceptor.java â€” í•µì‹¬ ë¡œì§

// ì´ ì¸í„°ì…‰í„°ëŠ” ëª¨ë“  WebSocket SEND ë©”ì‹œì§€ì— ëŒ€í•´ ì‹¤í–‰ë¨
@Override
public Message<?> preSend(Message<?> message, MessageChannel channel) {

    // SEND ëª…ë ¹ë§Œ ì²´í¬ (CONNECT, SUBSCRIBEëŠ” ì œí•œ ì•ˆ í•¨)
    if (!StompCommand.SEND.equals(accessor.getCommand())) {
        return message;  // SENDê°€ ì•„ë‹ˆë©´ ê·¸ëƒ¥ í†µê³¼
    }

    Long userId = Long.parseLong(user.getName());

    // ìœ ì €ë³„ ì¹´ìš´í„° ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±)
    RateWindow window = rateLimitMap.computeIfAbsent(userId, k -> new RateWindow());

    if (!window.tryAcquire(messagesPerSecond)) {
        // ì´ˆê³¼! â†’ ì—ëŸ¬ ë˜ì§ â†’ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ STOMP ERROR ì „ë‹¬
        throw new IllegalStateException("ë©”ì‹œì§€ ì „ì†¡ ì†ë„ ì œí•œì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.");
    }

    return message;  // ì œí•œ ì´ë‚´ â†’ í†µê³¼!
}
```

```java
// RateWindow â€” 1ì´ˆ ìœˆë„ìš° ì¹´ìš´í„°

private static class RateWindow {
    private final AtomicLong windowStart = new AtomicLong(System.currentTimeMillis());
    private final AtomicInteger count = new AtomicInteger(0);

    boolean tryAcquire(int limit) {
        long now = System.currentTimeMillis();

        // 1ì´ˆ(1000ms)ê°€ ì§€ë‚¬ìœ¼ë©´ ì¹´ìš´í„° ë¦¬ì…‹
        if (now - windowStart.get() >= 1000) {
            windowStart.set(now);  // ìœˆë„ìš° ì‹œì‘ ì‹œê° ê°±ì‹ 
            count.set(1);          // ì¹´ìš´í„° 1ë¡œ ë¦¬ì…‹ (í˜„ì¬ ë©”ì‹œì§€ í¬í•¨)
            return true;           // í†µê³¼!
        }

        // 1ì´ˆ ì´ë‚´: ì¹´ìš´í„° +1 í•˜ê³ , ì œí•œ ì´ë‚´ì¸ì§€ í™•ì¸
        return count.incrementAndGet() <= limit;
        // 11ë²ˆì§¸ ë©”ì‹œì§€ â†’ 11 > 10 â†’ false â†’ ì°¨ë‹¨!
    }
}
```

**ConcurrentHashMapê³¼ AtomicIntegerëŠ” ì™œ ì“°ë‚˜?**

```
ë¹„ìœ : ì€í–‰ ì°½êµ¬

[ì¼ë°˜ HashMap â€” ì°½êµ¬ 1ê°œ]
ì†ë‹˜ A, B, Cê°€ ë™ì‹œì— ì¤„ ì„œ ìˆëŠ”ë° ì°½êµ¬ê°€ 1ê°œ
â†’ Aê°€ ì²˜ë¦¬ë˜ëŠ” ë™ì•ˆ B, CëŠ” ê¸°ë‹¤ë ¤ì•¼ í•¨
â†’ ì‹¤ìˆ˜ë¡œ A, Bê°€ ë™ì‹œì— ì ‘ê·¼í•˜ë©´ ì”ê³ ê°€ ê¼¬ì¼ ìˆ˜ ìˆìŒ!

[ConcurrentHashMap â€” ì°½êµ¬ ì—¬ëŸ¬ ê°œ + ìë™ ì•ˆì „ì¥ì¹˜]
â†’ ì—¬ëŸ¬ ì†ë‹˜ì´ ë™ì‹œì— ì²˜ë¦¬ ê°€ëŠ¥
â†’ ìë™ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ (ë°ì´í„°ê°€ ê¼¬ì´ì§€ ì•ŠìŒ)

WebSocket ë©”ì‹œì§€ëŠ” ì—¬ëŸ¬ ìŠ¤ë ˆë“œ(ì§ì›)ê°€ ë™ì‹œì— ì²˜ë¦¬:
â†’ ì¼ë°˜ HashMap + int: ë™ì‹œ ì ‘ê·¼ ì‹œ ì¹´ìš´í„°ê°€ ê¼¬ì„!
   ì˜ˆ: ì¹´ìš´í„°ê°€ 5ì¸ë°, 2ëª…ì´ ë™ì‹œì— +1 â†’ 6ì´ ë˜ì–´ì•¼ í•˜ëŠ”ë° 6ì´ ë¨ (í•œ ë²ˆ ë¹ ì§)
â†’ ConcurrentHashMap + AtomicInteger: ë™ì‹œ ì ‘ê·¼í•´ë„ ì •í™•!
   ì˜ˆ: ì¹´ìš´í„°ê°€ 5ì¸ë°, 2ëª…ì´ ë™ì‹œì— +1 â†’ ì •í™•íˆ 7
```

### ì¸í„°ì…‰í„° ì‹¤í–‰ ìˆœì„œ

```
WebSocket ë©”ì‹œì§€ ë„ì°©
    â”‚
    â–¼
[1ë‹¨ê³„: WebSocketAuthInterceptor]
    "JWT í† í° í™•ì¸! ëˆ„êµ¬ì•¼?"
    â†’ "userId=1, ê¹€ì² ìˆ˜ë‹˜ì´ì‹œë„¤ìš”"
    â”‚
    â–¼
[2ë‹¨ê³„: RateLimitInterceptor]
    "ê¹€ì² ìˆ˜ë‹˜, ì´ë²ˆ 1ì´ˆì— ëª‡ ê°œ ë³´ëƒˆì§€?"
    â†’ "3ê°œì§¸? OK, í†µê³¼!"
    â†’ "11ê°œì§¸? STOP! ì†ë„ ì œí•œ ì´ˆê³¼!"
    â”‚
    â–¼ (í†µê³¼í•œ ê²½ìš°ë§Œ)
[3ë‹¨ê³„: @MessageMapping í•¸ë“¤ëŸ¬]
    ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰
```

---

## 15. STEP 11: ì‹¤íŒ¨í•œ ë©”ì‹œì§€ êµ¬ì¡°ëŒ€

### 1ì°¨ì—ì„œì˜ ë¬¸ì œ

```
[1ì°¨]
ë©”ì‹œì§€ ì‹¤íŒ¨ â†’ 3ë²ˆ ì¬ì‹œë„ â†’ ê·¸ë˜ë„ ì‹¤íŒ¨ â†’ í¬ê¸°... (ë©”ì‹œì§€ ì¦ë°œ!)

"ì–´ë–¤ ë©”ì‹œì§€ê°€ ì‹¤íŒ¨í–ˆëŠ”ì§€ ëª¨ë¦„"
"ì™œ ì‹¤íŒ¨í–ˆëŠ”ì§€ ëª¨ë¦„"
"ë‚˜ì¤‘ì— ì¬ì²˜ë¦¬í•˜ê³  ì‹¶ì–´ë„ ë°©ë²• ì—†ìŒ"

[2ì°¨ â€” DLT(Dead Letter Topic) ë„ì…]
ë©”ì‹œì§€ ì‹¤íŒ¨ â†’ 3ë²ˆ ì¬ì‹œë„ â†’ ê·¸ë˜ë„ ì‹¤íŒ¨ â†’ DLTì— ë³´ê´€! (ì¦ê±° ë³´ì¡´!)

"ì–´ë–¤ ë©”ì‹œì§€ê°€ ì‹¤íŒ¨í–ˆëŠ”ì§€ Kafka UIì—ì„œ í™•ì¸ ê°€ëŠ¥"
"ì™œ ì‹¤íŒ¨í–ˆëŠ”ì§€ ì—ëŸ¬ ë¡œê·¸ì— topic, partition, offset ê¸°ë¡"
"ë‚˜ì¤‘ì— ì¬ì²˜ë¦¬ ê°€ëŠ¥"
```

**DLT = Dead Letter Topic (ì£½ì€ í¸ì§€í•¨)**

```
ë¹„ìœ : ìš°ì²´êµ­ì˜ ë°˜ì†¡ í¸ì§€í•¨

ì •ìƒ í¸ì§€:
[ë³´ë‚¸ ì‚¬ëŒ] â†’ [ìš°í¸í•¨] â†’ [ë°°ë‹¬ì›] â†’ [ë°›ëŠ” ì‚¬ëŒ] âœ“

ë°˜ì†¡ í¸ì§€:
[ë³´ë‚¸ ì‚¬ëŒ] â†’ [ìš°í¸í•¨] â†’ [ë°°ë‹¬ì›] â†’ ì£¼ì†Œê°€ ì—†ìŒ!
                                    â†’ 1ì°¨ ì‹œë„: ë‹¤ì‹œ ê°€ë´„ â†’ ì‹¤íŒ¨
                                    â†’ 2ì°¨ ì‹œë„: ë˜ ê°€ë´„ â†’ ì‹¤íŒ¨
                                    â†’ 3ì°¨ ì‹œë„: ë§ˆì§€ë§‰ â†’ ì‹¤íŒ¨
                                    â†’ [ë°˜ì†¡ í¸ì§€í•¨(DLT)]ì— ë³´ê´€
                                    â†’ ë‚˜ì¤‘ì— ìš°ì²´êµ­ ì§ì›ì´ í™•ì¸

ìš°ë¦¬ ì‹œìŠ¤í…œ:
chat.messages â†’ Consumer ì²˜ë¦¬ ì‹¤íŒ¨ (3íšŒ ì¬ì‹œë„)
              â†’ chat.messages.dltì— ì›ë³¸ ë©”ì‹œì§€ ë³´ê´€
              â†’ Kafka UI(localhost:8090)ì—ì„œ í™•ì¸ ê°€ëŠ¥
```

```java
// KafkaConfig.java â€” DLT ì„¤ì •

// DLT í† í”½ ìƒì„± (ì•± ì‹œì‘ ì‹œ ìë™)
@Bean
public NewTopic messagesDltTopic() {
    return TopicBuilder.name("chat.messages.dlt")
            .partitions(1)    // ì‹¤íŒ¨ ë©”ì‹œì§€ìš©ì´ë¼ 1ì¹¸ì´ë©´ ì¶©ë¶„
            .build();
}

// DLT Recoverer: 3ë²ˆ ì‹¤íŒ¨í•œ ë©”ì‹œì§€ë¥¼ DLTë¡œ ë³´ëƒ„
private DeadLetterPublishingRecoverer deadLetterRecoverer(KafkaTemplate<String, Object> kafkaTemplate) {
    return new DeadLetterPublishingRecoverer(kafkaTemplate,
            (record, ex) -> {
                // ì‹¤íŒ¨ ì •ë³´ ë¡œê¹…: "ì–´ë–¤ ë©”ì‹œì§€ê°€, ì–´ë””ì„œ, ì™œ ì‹¤íŒ¨í–ˆëŠ”ì§€"
                log.error("DLT ì „ì†¡: topic={}, partition={}, offset={}, error={}",
                        record.topic(), record.partition(), record.offset(), ex.getMessage());
                // ì›ë³¸ í† í”½ ì´ë¦„ + ".dlt" í† í”½ìœ¼ë¡œ ì „ì†¡
                return new TopicPartition(record.topic() + ".dlt", 0);
            });
}
```

### ì—ëŸ¬ ë¡œê¹… ê°•í™” â€” "ë²”ì¸ íŠ¹ì •"

```
[1ì°¨ ì—ëŸ¬ ë¡œê·¸]
"ë©”ì‹œì§€ ì €ì¥ ì‹¤íŒ¨: messageKey=abc-123"
â†’ ì‹¤íŒ¨í•œ ê±´ ì•Œê² ëŠ”ë°... ì–´ë””ì„œ? ì™œ?

[2ì°¨ ì—ëŸ¬ ë¡œê·¸]
"ë©”ì‹œì§€ ì €ì¥ ì‹¤íŒ¨: messageKey=abc-123, topic=chat.messages, partition=3, offset=42"
â†’ topic: ì–´ëŠ ìš°í¸í•¨ì—ì„œ ì™”ëŠ”ì§€
â†’ partition: ëª‡ ë²ˆ ì¹¸ì— ìˆì—ˆëŠ”ì§€
â†’ offset: ëª‡ ë²ˆì§¸ í¸ì§€ì˜€ëŠ”ì§€
â†’ Kafka UIì—ì„œ ì •í™•íˆ ì°¾ì•„ì„œ ì›ì¸ ë¶„ì„ ê°€ëŠ¥!
```

```
ì „ì²´ ì‹¤íŒ¨ ì²˜ë¦¬ íë¦„:

ë©”ì‹œì§€ ë„ì°© â†’ Consumer ì²˜ë¦¬
    â”‚
    â”œâ”€â”€ ì„±ê³µ! â†’ ack.acknowledge() â†’ "OK, ë‹¤ìŒ ë©”ì‹œì§€!"
    â”‚
    â””â”€â”€ ì‹¤íŒ¨! â†’ DefaultErrorHandlerê°€ ê°œì…
                â”‚
                â”œâ”€â”€ 1ì´ˆ í›„ ì¬ì‹œë„ (1íšŒì°¨) â†’ ë˜ ì‹¤íŒ¨
                â”œâ”€â”€ 1ì´ˆ í›„ ì¬ì‹œë„ (2íšŒì°¨) â†’ ë˜ ì‹¤íŒ¨
                â””â”€â”€ 1ì´ˆ í›„ ì¬ì‹œë„ (3íšŒì°¨) â†’ ë˜ ì‹¤íŒ¨
                    â”‚
                    â–¼
              DeadLetterPublishingRecoverer
              â”‚
              â”œâ”€â”€ ì›ë³¸ ë©”ì‹œì§€ë¥¼ chat.messages.dltì— ì €ì¥
              â”œâ”€â”€ ì—ëŸ¬ ì •ë³´ í•¨ê»˜ ê¸°ë¡
              â””â”€â”€ ConsumerëŠ” ë‹¤ìŒ ë©”ì‹œì§€ ì²˜ë¦¬ë¡œ ë„˜ì–´ê°
                  (ì‹¤íŒ¨í•œ ë©”ì‹œì§€ ë•Œë¬¸ì— ì „ì²´ê°€ ë©ˆì¶”ì§€ ì•ŠìŒ!)
```

---

## 16. STEP 12: ì ‘ì† ì¤‘ í‘œì‹œ

### ì¹´ì¹´ì˜¤í†¡ì˜ "ì ‘ì† ì¤‘" ê¸°ëŠ¥

```
ì¹´ì¹´ì˜¤í†¡ í”„ë¡œí•„ì— "1ë¶„ ì „ ì ‘ì†" ì´ëŸ° ê±° ë³¸ ì  ìˆì£ ?
ìš°ë¦¬ë„ ë¹„ìŠ·í•œ ê¸°ëŠ¥ì„ ë§Œë“­ë‹ˆë‹¤:
â†’ ì±„íŒ…ë°©ì—ì„œ "ëˆ„ê°€ ì§€ê¸ˆ ì ‘ì† ì¤‘ì¸ì§€" ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œ
```

### ì „ì²´ ì„¤ê³„ â€” 4ë‹¨ê³„

```
[1ë‹¨ê³„: ê°ì§€]
ì‚¬ìš©ìê°€ WebSocket ì—°ê²° â†’ "ì´ ì‚¬ëŒ ì ‘ì†í–ˆë„¤!"
ì‚¬ìš©ìê°€ WebSocket ëŠê¹€ â†’ "ì´ ì‚¬ëŒ ë‚˜ê°”ë„¤!"
â†’ WebSocketEventListenerê°€ ê°ì§€

[2ë‹¨ê³„: ê¸°ë¡]
Redisì— ê¸°ë¡: "user:presence:1" = "ONLINE" (60ì´ˆ í›„ ìë™ ì‚­ì œ)
â†’ PresenceServiceê°€ ë‹´ë‹¹

[3ë‹¨ê³„: ì•Œë¦¼]
Redis Pub/Subë¡œ ëª¨ë“  ì„œë²„ì— ë°©ì†¡: "1ë²ˆ ìœ ì €ê°€ ì ‘ì†í–ˆì–´ìš”!"
â†’ RedisPubSubServiceê°€ ë‹´ë‹¹

[4ë‹¨ê³„: ì „ë‹¬]
STOMPë¡œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬: /topic/presence
â†’ í´ë¼ì´ì–¸íŠ¸ í™”ë©´ì— "ì² ìˆ˜ë‹˜ ì ‘ì† ì¤‘" í‘œì‹œ
```

### ê° ë‹¨ê³„ ìì„¸íˆ

**1ë‹¨ê³„: WebSocketEventListener â€” "ë¬¸ì§€ê¸°"**

```java
@Component
public class WebSocketEventListener {

    // ëˆ„êµ°ê°€ WebSocketì— ì—°ê²°í•˜ë©´ ìë™ í˜¸ì¶œ
    @EventListener
    public void handleWebSocketConnect(SessionConnectEvent event) {
        Long userId = extractUserId(...);   // "ëˆ„ê°€ ì—°ê²°í•œ ê±°ì•¼?" â†’ userId=1
        presenceService.setOnline(userId);  // Redisì— "ì ‘ì† ì¤‘" ê¸°ë¡
        redisPubSubService.publishPresence(PresenceEvent.online(userId));
        //                                 â†’ ëª¨ë“  ì„œë²„ì— "1ë²ˆ ìœ ì € ì ‘ì†!" ë°©ì†¡
    }

    // ëˆ„êµ°ê°€ WebSocketì´ ëŠê¸°ë©´ ìë™ í˜¸ì¶œ
    @EventListener
    public void handleWebSocketDisconnect(SessionDisconnectEvent event) {
        Long userId = extractUserId(...);
        presenceService.setOffline(userId);  // Redisì—ì„œ "ì ‘ì† ì¤‘" ì‚­ì œ
        redisPubSubService.publishPresence(PresenceEvent.offline(userId));
        //                                 â†’ ëª¨ë“  ì„œë²„ì— "1ë²ˆ ìœ ì € í‡´ì¥!" ë°©ì†¡
    }
}
```

```
@EventListenerê°€ ë­ì•¼?

ë¹„ìœ : ê±´ë¬¼ ì¶œì… ì„¼ì„œ

ì„¼ì„œë¥¼ ë‹¬ì•„ë†“ìœ¼ë©´:
â†’ ëˆ„ê°€ ë“¤ì–´ì˜¤ë©´ "ì‚~" ì†Œë¦¬ (SessionConnectEvent)
â†’ ëˆ„ê°€ ë‚˜ê°€ë©´ "ì‚~" ì†Œë¦¬ (SessionDisconnectEvent)

ê°œë°œìëŠ” "ì‚~ ì†Œë¦¬ ë‚˜ë©´ ì´ê±° í•´ì¤˜"ë¼ê³ ë§Œ ì½”ë“œë¥¼ ì§œë©´ ë¨
â†’ ì„¼ì„œ(Spring)ê°€ ì•Œì•„ì„œ ê°ì§€í•˜ê³  ì•Œë ¤ì¤Œ!
```

**2ë‹¨ê³„: PresenceService â€” "ì¶œì„ë¶€"**

```java
@Service
public class PresenceService {

    // Redisì— ì €ì¥í•˜ëŠ” í‚¤: "user:presence:{userId}"
    // ê°’: "ONLINE"
    // TTL(ìœ íš¨ê¸°ê°„): 60ì´ˆ

    public void setOnline(Long userId) {
        // Redis: SET "user:presence:1" "ONLINE" EX 60
        // â†’ 60ì´ˆ í›„ ìë™ ì‚­ì œ!
        redisTemplate.opsForValue().set(
            "user:presence:" + userId, "ONLINE", Duration.ofSeconds(60));
    }

    public void setOffline(Long userId) {
        // Redis: DEL "user:presence:1"
        // â†’ ì¦‰ì‹œ ì‚­ì œ
        redisTemplate.delete("user:presence:" + userId);
    }

    public boolean isOnline(Long userId) {
        // Redis: EXISTS "user:presence:1"
        // â†’ í‚¤ê°€ ìˆìœ¼ë©´ true(ì ‘ì† ì¤‘), ì—†ìœ¼ë©´ false(ì˜¤í”„ë¼ì¸)
        return Boolean.TRUE.equals(redisTemplate.hasKey("user:presence:" + userId));
    }

    public Set<Long> getOnlineMembers(Long roomId) {
        // 1. DBì—ì„œ ì´ ë°©ì˜ ë©¤ë²„ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        // 2. ê° ë©¤ë²„ê°€ ì˜¨ë¼ì¸ì¸ì§€ Redisì—ì„œ í™•ì¸
        // 3. ì˜¨ë¼ì¸ì¸ ë©¤ë²„ë§Œ ë°˜í™˜
    }
}
```

**TTL(Time To Live) 60ì´ˆ â€” ì™œ?**

```
ë¹„ìœ : ë„ì„œê´€ ì¢Œì„ ì˜ˆì•½

"ì¢Œì„ì— ì•‰ìœ¼ë©´ 1ì‹œê°„ ì˜ˆì•½ë©ë‹ˆë‹¤. 1ì‹œê°„ í›„ì—ë„ ê³„ì‹œë©´ ë‹¤ì‹œ ì˜ˆì•½í•´ì£¼ì„¸ìš”."

[ì •ìƒ í‡´ì¥]
í•™ìƒì´ ì§ ì‹¸ê³  ë‚˜ê° â†’ "ì¢Œì„ ë¹„ì—ˆìŒ" í‘œì‹œ â†’ OK!

[ë¹„ì •ìƒ í‡´ì¥ â€” ì •ì „ìœ¼ë¡œ ê±´ë¬¼ ëŒ€í”¼]
í•™ìƒì´ ì§ë„ ëª» ì±™ê¸°ê³  ë‚˜ê° â†’ "ì¢Œì„ ì‚¬ìš© ì¤‘" ê·¸ëŒ€ë¡œ!
â†’ ì˜ì›íˆ "ì‚¬ìš© ì¤‘"ìœ¼ë¡œ í‘œì‹œ?!

[TTLë¡œ í•´ê²°]
1ì‹œê°„ í›„ ìë™ìœ¼ë¡œ "ë¹„ì—ˆìŒ" í‘œì‹œ
â†’ ì •ìƒ í‡´ì¥ì´ë“  ë¹„ì •ìƒ í‡´ì¥ì´ë“ , ìµœëŒ€ 1ì‹œê°„ í›„ì—ëŠ” ì •ë¦¬ë¨

ìš°ë¦¬ ì„œë¹„ìŠ¤:
ì„œë²„ê°€ ê°‘ìê¸° êº¼ì§€ë©´ â†’ SessionDisconnectEventê°€ ì•ˆ ë‚˜ì˜´
â†’ Redisì˜ "user:presence:1" í‚¤ê°€ ì‚­ì œë˜ì§€ ì•ŠìŒ
â†’ BUT! 60ì´ˆ í›„ TTLì— ì˜í•´ ìë™ ì‚­ì œ!
â†’ ìµœëŒ€ 60ì´ˆ í›„ì—ëŠ” ì˜¬ë°”ë¥´ê²Œ "ì˜¤í”„ë¼ì¸" í‘œì‹œ
```

**3ë‹¨ê³„ + 4ë‹¨ê³„: ì„œë²„ ê°„ ìƒíƒœ ê³µìœ  + í´ë¼ì´ì–¸íŠ¸ ì „ë‹¬**

```
ì™œ Redis Pub/Subê°€ í•„ìš”í•´?

ì„œë²„ê°€ 2ëŒ€ì¸ ê²½ìš°:
ì‚¬ìš©ì A â†’ [ì„œë²„ 1] â† ì—¬ê¸°ì„œ ì ‘ì† ê°ì§€
ì‚¬ìš©ì B â†’ [ì„œë²„ 2] â† Bë„ "A ì ‘ì† ì¤‘"ì„ ì•Œì•„ì•¼ í•¨!

ì„œë²„ 1ë§Œ ì•Œë©´ ì•ˆ ë˜ê³ , ì„œë²„ 2ë„ ì•Œì•„ì•¼ í•¨:
â†’ Redis Pub/Subë¡œ ëª¨ë“  ì„œë²„ì— ë°©ì†¡!

íë¦„:
ì„œë²„1: "A ì ‘ì†!" â†’ Redis PUBLISH "chat:presence" â†’ ëª¨ë“  ì„œë²„ì— ì „ë‹¬
ì„œë²„1: ë°©ì†¡ ìˆ˜ì‹  â†’ /topic/presenceë¡œ â†’ ì‚¬ìš©ì Aì—ê²Œ ì•Œë¦¼
ì„œë²„2: ë°©ì†¡ ìˆ˜ì‹  â†’ /topic/presenceë¡œ â†’ ì‚¬ìš©ì Bì—ê²Œ ì•Œë¦¼

ê²°ê³¼: A, B ëª¨ë‘ "Aê°€ ì ‘ì† ì¤‘"ì´ë¼ëŠ” ê²ƒì„ ì•Œê²Œ ë¨!
```

### REST API â€” ì±„íŒ…ë°© ì…ì¥ ì‹œ ì´ˆê¸° ìƒíƒœ

```java
// GET /api/rooms/{roomId}/members/online
// â†’ ì±„íŒ…ë°© ë©¤ë²„ ì¤‘ ì§€ê¸ˆ ì ‘ì† ì¤‘ì¸ ì‚¬ëŒì˜ ID ëª©ë¡

@GetMapping("/{roomId}/members/online")
public ResponseEntity<Set<Long>> getOnlineMembers(@PathVariable Long roomId) {
    return ResponseEntity.ok(presenceService.getOnlineMembers(roomId));
}
// ì‘ë‹µ ì˜ˆì‹œ: [1, 3, 5]  â† 1ë²ˆ, 3ë²ˆ, 5ë²ˆ ìœ ì €ê°€ ì ‘ì† ì¤‘
```

```
í´ë¼ì´ì–¸íŠ¸ ì…ì¥ì—ì„œ:

ì±„íŒ…ë°©ì— ë“¤ì–´ì˜¬ ë•Œ:
1. REST APIë¡œ í˜„ì¬ ì ‘ì† ì¤‘ì¸ ë©¤ë²„ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (ì´ˆê¸° ìƒíƒœ)
2. WebSocketìœ¼ë¡œ /topic/presence êµ¬ë… (ì´í›„ ë³€ê²½ ì‚¬í•­ ì‹¤ì‹œê°„ ìˆ˜ì‹ )

â†’ ì²˜ìŒì—ëŠ” REST APIë¡œ í˜„ì¬ ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ê³ 
â†’ ì´í›„ì—ëŠ” WebSocketìœ¼ë¡œ ë³€ê²½ë§Œ ìˆ˜ì‹  (íš¨ìœ¨ì !)
```

---

## 17. STEP 13: ì„œë²„ ì—¬ëŸ¬ ëŒ€ë¡œ ëŠ˜ë¦¬ê¸°

### Dockerfile â€” "ì•±ì„ ìƒìì— ë„£ê¸°"

DockerëŠ” ìš°ë¦¬ ì•±ì„ **ì–´ë””ì„œë“  ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ìƒì**ì— ë‹´ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.

```
ë¹„ìœ : ì´ì‚¬í•  ë•Œ ì§ ì‹¸ê¸°

[Dockerfile ì—†ì´]
"ì´ ì•± ì‹¤í–‰í•˜ë ¤ë©´ Java 21 ê¹”ê³ , Gradle ê¹”ê³ , ì†ŒìŠ¤ ë‹¤ìš´ë¡œë“œí•˜ê³ ,
ë¹Œë“œí•˜ê³ ... ì„¤ì • íŒŒì¼ ìˆ˜ì •í•˜ê³ ..."
â†’ ë‹¤ë¥¸ ì»´í“¨í„°ì—ì„œ ì‹¤í–‰í•˜ë ¤ë©´ ì´ê±¸ ë˜ í•´ì•¼ í•¨!

[Dockerfile ì‚¬ìš©]
"docker run í•˜ë©´ ë!"
â†’ Java, ì†ŒìŠ¤, ì„¤ì • ëª¨ë“  ê²Œ ìƒì(Docker ì´ë¯¸ì§€) ì•ˆì—!
â†’ ì–´ëŠ ì»´í“¨í„°ë“  docker runë§Œ í•˜ë©´ ë™ì¼í•˜ê²Œ ì‹¤í–‰
```

```dockerfile
# ìš°ë¦¬ Dockerfile â€” 2ë‹¨ê³„ë¡œ ë‚˜ëˆ” (Multi-stage Build)

# 1ë‹¨ê³„: ìš”ë¦¬ (ë¹Œë“œ)
FROM eclipse-temurin:21-jdk AS build    # Java 21 ê°œë°œ ë„êµ¬ (ë„ë§ˆ, ì¹¼, ëƒ„ë¹„...)
WORKDIR /app
COPY gradle/ gradle/
COPY gradlew build.gradle.kts settings.gradle.kts ./
RUN chmod +x gradlew && ./gradlew dependencies --no-daemon || true
# â†‘ ì¬ë£Œ(ì˜ì¡´ì„±) ë¨¼ì € ì¤€ë¹„ â€” ë‹¤ìŒì— ìš”ë¦¬í•  ë•Œ ì´ ë‹¨ê³„ëŠ” ê±´ë„ˆëœ€! (ìºì‹±)

COPY src/ src/
RUN ./gradlew bootJar --no-daemon -x test
# â†‘ ìš”ë¦¬ ì™„ì„±! (JAR íŒŒì¼ = ì™„ì„±ëœ ìš”ë¦¬)

# 2ë‹¨ê³„: ì„œë¹™ (ì‹¤í–‰)
FROM eclipse-temurin:21-jre             # Java 21 ì‹¤í–‰ê¸°ë§Œ (ì ‘ì‹œ, í¬í¬)
WORKDIR /app
COPY --from=build /app/build/libs/*.jar app.jar
# â†‘ 1ë‹¨ê³„ì—ì„œ ë§Œë“  JARë§Œ ê°€ì ¸ì˜´ (ë„ë§ˆ, ì¹¼, ëƒ„ë¹„ëŠ” í•„ìš” ì—†ìŒ!)

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
# â†‘ ì´ ëª…ë ¹ì–´ë¡œ ì•± ì‹¤í–‰
```

```
ì™œ 2ë‹¨ê³„ë¡œ ë‚˜ëˆ„ë‚˜?

[1ë‹¨ê³„ ì´ë¯¸ì§€ í¬ê¸°]
JDK(400MB) + ì†ŒìŠ¤ ì½”ë“œ(10MB) + Gradle(100MB) + JAR(50MB) = ~560MB

[2ë‹¨ê³„ ì´ë¯¸ì§€ í¬ê¸°]
JRE(200MB) + JAR(50MB) = ~250MB

â†’ ì ˆë°˜ ì´ìƒ ì¤„ì–´ë“¦!
â†’ ì†ŒìŠ¤ ì½”ë“œê°€ ìµœì¢… ì´ë¯¸ì§€ì— ì—†ìŒ (ë³´ì•ˆ!)
â†’ ì„œë²„ì— ë°°í¬í•  ë•Œ ë‹¤ìš´ë¡œë“œ ì‹œê°„ ì ˆì•½
```

### docker-compose â€” "ì„œë²„ 2ëŒ€ ë™ì‹œ ì‹¤í–‰"

```yaml
# docker-compose.ymlì— ì¶”ê°€ëœ ë¶€ë¶„

app-1:                           # ì„œë²„ 1í˜¸
    build: .                     # ìœ„ì˜ Dockerfileë¡œ ì´ë¯¸ì§€ ìƒì„±
    environment:
      DB_HOST: postgres          # Docker ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì»¨í…Œì´ë„ˆ ì´ë¦„ìœ¼ë¡œ ì ‘ê·¼
      REDIS_HOST: redis
      KAFKA_BOOTSTRAP_SERVERS: kafka:9092
    ports:
      - "8081:8080"              # ë‚´ ì»´í“¨í„°ì˜ 8081ë²ˆ â†’ ì»¨í…Œì´ë„ˆì˜ 8080ë²ˆ
    depends_on:
      postgres:
        condition: service_healthy  # PostgreSQLì´ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°!

app-2:                           # ì„œë²„ 2í˜¸ (ì„¤ì • ë™ì¼, í¬íŠ¸ë§Œ ë‹¤ë¦„)
    build: .
    environment:
      DB_HOST: postgres
      REDIS_HOST: redis
      KAFKA_BOOTSTRAP_SERVERS: kafka:9092
    ports:
      - "8082:8080"              # ë‚´ ì»´í“¨í„°ì˜ 8082ë²ˆ
    depends_on: ...
```

**í™˜ê²½ë³€ìˆ˜ fallback â€” "ì–´ë””ì„œ ì‹¤í–‰ë˜ë“  OK"**

```yaml
# application.yml
spring:
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/chat
#                          â†‘ í™˜ê²½ë³€ìˆ˜ê°€ ìˆìœ¼ë©´ ê·¸ ê°’, ì—†ìœ¼ë©´ localhost

# ë¡œì»¬ ê°œë°œ: DB_HOST í™˜ê²½ë³€ìˆ˜ ì—†ìŒ â†’ localhost ì‚¬ìš©
# Docker:   DB_HOST=postgres í™˜ê²½ë³€ìˆ˜ ì„¤ì • â†’ postgres ì‚¬ìš©

â†’ ê°™ì€ ì½”ë“œë¡œ ë¡œì»¬ì—ì„œë„, Dockerì—ì„œë„ ì‹¤í–‰ ê°€ëŠ¥!
```

**depends_on + service_healthyê°€ ì™œ ì¤‘ìš”í•´?**

```
ë¹„ìœ : ìš”ë¦¬ ìˆœì„œ

[depends_onë§Œ ì‚¬ìš©]
"ë°¥ ì§“ê¸°" ì‹œì‘ â†’ "ë°˜ì°¬ ë§Œë“¤ê¸°" ë°”ë¡œ ì‹œì‘
â†’ ë°¥ì´ ì•„ì§ ì•ˆ ëëŠ”ë° "ì‹ì‚¬ ì¤€ë¹„ ì™„ë£Œ!"ë¼ê³  í•  ìˆ˜ ìˆìŒ!

[depends_on + service_healthy ì‚¬ìš©]
"ë°¥ ì§“ê¸°" ì‹œì‘ â†’ ë°¥ì†¥ì´ "ë°¥ ë‹¤ ëì–´!" ì•Œë¦¼
â†’ ê·¸ì œì„œì•¼ "ë°˜ì°¬ ë§Œë“¤ê¸°" ì‹œì‘

Dockerì—ì„œ:
postgres ì»¨í…Œì´ë„ˆ ì‹œì‘ â†’ DB ì´ˆê¸°í™” ì¤‘ (ì•„ì§ ì¤€ë¹„ ì•ˆ ë¨!)
healthcheck: pg_isready â†’ "ì•„ì§ì´ìš”..." â†’ "ì•„ì§ì´ìš”..." â†’ "ì¤€ë¹„ ëì–´ìš”!"
â†’ ê·¸ì œì„œì•¼ app-1 ì‹œì‘ â†’ DB ì—°ê²° ì„±ê³µ!
```

### Kafka Consumer Groupì˜ ë§ˆë²• â€” ìë™ ì¼ ë¶„ë°°

```
[ì„œë²„ 1ëŒ€ì¼ ë•Œ]
chat.messages í† í”½ (íŒŒí‹°ì…˜ 6ê°œ)
íŒŒí‹°ì…˜ 0, 1, 2, 3, 4, 5 â†’ ì „ë¶€ ì„œë²„1ì˜ Consumerê°€ ì²˜ë¦¬

[ì„œë²„ 2ëŒ€ë¡œ ëŠ˜ë¦¬ë©´? â€” ìë™ ë¦¬ë°¸ëŸ°ì‹±!]
íŒŒí‹°ì…˜ 0, 1, 2 â†’ ì„œë²„1(app-1)ì˜ Consumer
íŒŒí‹°ì…˜ 3, 4, 5 â†’ ì„œë²„2(app-2)ì˜ Consumer

ì½”ë“œë¥¼ í•œ ì¤„ë„ ì•ˆ ë°”ê¿¨ëŠ”ë° ìë™ìœ¼ë¡œ ë¶„ë°°ë¨!

[ì„œë²„ 3ëŒ€ë¡œ ëŠ˜ë¦¬ë©´?]
íŒŒí‹°ì…˜ 0, 1 â†’ ì„œë²„1
íŒŒí‹°ì…˜ 2, 3 â†’ ì„œë²„2
íŒŒí‹°ì…˜ 4, 5 â†’ ì„œë²„3

â†’ ì„œë²„ë§Œ ì¶”ê°€í•˜ë©´ ìë™ìœ¼ë¡œ ë¶€í•˜ ë¶„ì‚°!
â†’ ì´ê²Œ Kafka Consumer Groupì˜ í•µì‹¬ ê°€ì¹˜!
â†’ ë‹¨, íŒŒí‹°ì…˜ ìˆ˜(6) ì´ìƒì˜ ì„œë²„ëŠ” ì˜ë¯¸ ì—†ìŒ (ë…¸ëŠ” ì„œë²„ ë°œìƒ)
```

### í†µí•© í…ŒìŠ¤íŠ¸

**ConsumerRecoveryIntegrationTest â€” "Kafka ìš°ì²´êµ­ì´ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸"**

```java
@Test
@DisplayName("ê°™ì€ ë©”ì‹œì§€ë¥¼ 2ë²ˆ ë³´ë‚´ë„ DBì— 1ê°œë§Œ ì €ì¥ë˜ëŠ”ì§€ í™•ì¸")
void duplicateMessageKey_shouldSaveOnlyOnce() {
    UUID messageKey = UUID.randomUUID();  // ìœ ì¼í•œ ë©”ì‹œì§€ ID ìƒì„±
    ChatMessageEvent event = new ChatMessageEvent(
            messageKey, room.getId(), user1.getId(), "ìœ ì €1",
            "ì¤‘ë³µ í…ŒìŠ¤íŠ¸", MessageType.TEXT, LocalDateTime.now());

    // ê°™ì€ ë©”ì‹œì§€ë¥¼ 2ë²ˆ Kafkaì— ì „ì†¡!
    kafkaTemplate.send("chat.messages", String.valueOf(room.getId()), event);
    kafkaTemplate.send("chat.messages", String.valueOf(room.getId()), event);

    // ê¸°ë‹¤ë ¸ë‹¤ê°€... DBì— 1ê±´ë§Œ ì €ì¥ë˜ì—ˆëŠ”ì§€ í™•ì¸
    await().atMost(10, TimeUnit.SECONDS).untilAsserted(() -> {
        long count = messageRepository.countByMessageKey(messageKey);
        assertThat(count).isEqualTo(1);  // 2ë²ˆ ë³´ëƒˆì§€ë§Œ 1ê±´ë§Œ ìˆì–´ì•¼ í•¨!
    });
}
```

**Awaitility â€” "ë¹„ë™ê¸° ì‘ì—… ê¸°ë‹¤ë¦¬ê¸°"**

```
ë¹„ìœ : í”¼ì ì£¼ë¬¸

"í”¼ì ì£¼ì„¸ìš”!" í•˜ê³  ë°”ë¡œ "í”¼ì ì™”ì–´?"ë¼ê³  í™•ì¸í•˜ë©´?
â†’ ì•„ì§ ë§Œë“¤ê³  ìˆëŠ”ë°! ë‹¹ì—°íˆ ì•ˆ ì™”ì§€!

[Thread.sleep ë°©ì‹ â€” ë¬´ì¡°ê±´ ê¸°ë‹¤ë¦¬ê¸°]
Thread.sleep(5000);  // 5ì´ˆ ê¸°ë‹¤ë¦¼
"í”¼ì ì™”ì–´?" â†’ ë¹ ë¥¸ ë‚ ì€ 2ì´ˆë©´ ë˜ëŠ”ë° 5ì´ˆë‚˜ ê¸°ë‹¤ë¦¼ (ë¹„íš¨ìœ¨)
             â†’ ëŠë¦° ë‚ ì€ 5ì´ˆë„ ë¶€ì¡±í•  ìˆ˜ ìˆìŒ (ë¶ˆì•ˆì •)

[Awaitility ë°©ì‹ â€” ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê¸°]
await().atMost(10, TimeUnit.SECONDS).untilAsserted(() -> {
    assertThat(í”¼ìì™”ëŠ”ì§€).isTrue();
});
// ë¹ ë¥¸ ë‚ : 0.5ì´ˆ ë§Œì— í™•ì¸ â†’ ë°”ë¡œ í†µê³¼!
// ëŠë¦° ë‚ : 7ì´ˆ í›„ í™•ì¸ â†’ ê·¸ë•Œ í†µê³¼!
// 10ì´ˆ ì•ˆì— ì•ˆ ì˜¤ë©´? â†’ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨! (ë­”ê°€ ë¬¸ì œ ìˆìŒ)

â†’ ë¹ ë¥¼ ë•ŒëŠ” ë¹ ë¥´ê²Œ, ëŠë¦´ ë•Œë„ ì•ˆì „í•˜ê²Œ!
```

**PresenceIntegrationTest â€” "ì ‘ì† ìƒíƒœê°€ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸"**

```java
@Test
@DisplayName("ì˜¨ë¼ì¸ìœ¼ë¡œ ë°”ê¾¸ê³  â†’ í™•ì¸ â†’ ì˜¤í”„ë¼ì¸ìœ¼ë¡œ ë°”ê¾¸ê³  â†’ í™•ì¸")
void presenceOnlineOffline() {
    // ì²˜ìŒ: ì˜¤í”„ë¼ì¸ì´ì–´ì•¼ í•¨
    assertThat(presenceService.isOnline(user1Id)).isFalse();

    // ì˜¨ë¼ì¸ìœ¼ë¡œ ì„¤ì •
    presenceService.setOnline(user1Id);
    assertThat(presenceService.isOnline(user1Id)).isTrue();  // ì˜¨ë¼ì¸ì´ì–´ì•¼ í•¨!

    // ë‹¤ì‹œ ì˜¤í”„ë¼ì¸ìœ¼ë¡œ ì„¤ì •
    presenceService.setOffline(user1Id);
    assertThat(presenceService.isOnline(user1Id)).isFalse(); // ì˜¤í”„ë¼ì¸ì´ì–´ì•¼ í•¨!
}

@Test
@DisplayName("ì±„íŒ…ë°©ì—ì„œ ëˆ„ê°€ ì ‘ì† ì¤‘ì¸ì§€ ì¡°íšŒ")
void getOnlineMembers() {
    presenceService.setOnline(user1Id);         // user1ë§Œ ì˜¨ë¼ì¸

    Set<Long> online = presenceService.getOnlineMembers(roomId);
    assertThat(online).containsExactly(user1Id); // user1ë§Œ ìˆì–´ì•¼ í•¨!

    presenceService.setOnline(user2Id);         // user2ë„ ì˜¨ë¼ì¸

    online = presenceService.getOnlineMembers(roomId);
    assertThat(online).containsExactlyInAnyOrder(user1Id, user2Id);
    // user1, user2 ë‘˜ ë‹¤ ìˆì–´ì•¼ í•¨! (ìˆœì„œ ìƒê´€ì—†ì´)

    // REST APIë¡œë„ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸
    ResponseEntity<Set<Long>> response = restTemplate.exchange(
            baseUrl + "/api/rooms/" + roomId + "/members/online",
            HttpMethod.GET,
            new HttpEntity<>(authHeaders(token1)),
            new ParameterizedTypeReference<>() {});

    assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
    assertThat(response.getBody()).containsExactlyInAnyOrder(user1Id, user2Id);
}
```

---

# Part 4: ê¶ê¸ˆí•  ìˆ˜ ìˆëŠ” ê²ƒë“¤

---

---

# Part 4: 3ì°¨ êµ¬í˜„ (ëª¨ë‹ˆí„°ë§ + ì„±ëŠ¥ ìµœì í™”)

> 2ì°¨ê¹Œì§€ëŠ” "ë™ì‘í•˜ê²Œ" ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. 3ì°¨ì—ì„œëŠ” "ë¹ ë¥´ê²Œ" ë§Œë“­ë‹ˆë‹¤.
> ìì„¸í•œ ìˆ˜ì¹˜ì™€ ë¶„ì„ì€ [ì„±ëŠ¥ ìµœì í™” ê¸°ë¡](PERF_RESULT.md)ì— ìˆìŠµë‹ˆë‹¤.

---

## 18. STEP 14: ê±´ê°• ìƒíƒœíŒ ë§Œë“¤ê¸°

### í•œ ì¤„ ìš”ì•½

> ì„œë²„ê°€ ì§€ê¸ˆ **ì–¼ë§ˆë‚˜ ë°”ìœì§€, ì–´ë””ê°€ ì•„í”ˆì§€** ì‹¤ì‹œê°„ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ” ëŒ€ì‹œë³´ë“œë¥¼ ë§Œë“­ë‹ˆë‹¤.

### ë¹„ìœ : ìë™ì°¨ ê³„ê¸°íŒ

```
ìë™ì°¨ë¥¼ ìš´ì „í•  ë•Œ:
â†’ ì†ë„ê³„: ì§€ê¸ˆ ì–¼ë§ˆë‚˜ ë¹¨ë¦¬ ê°€ëŠ”ì§€
â†’ RPM: ì—”ì§„ì´ ì–¼ë§ˆë‚˜ ì—´ì‹¬íˆ ë„ëŠ”ì§€
â†’ ì—°ë£Œê³„: ê¸°ë¦„ì´ ì–¼ë§ˆë‚˜ ë‚¨ì•˜ëŠ”ì§€
â†’ ê²½ê³ ë“±: ë­”ê°€ ë¬¸ì œê°€ ìˆìœ¼ë©´ ë¹¨ê°„ë¶ˆ

ì„œë²„ë„ ë§ˆì°¬ê°€ì§€:
â†’ RPS: ì´ˆë‹¹ ëª‡ ê°œì˜ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ”ì§€
â†’ ì‘ë‹µì‹œê°„: í•œ ìš”ì²­ì— ì–¼ë§ˆë‚˜ ê±¸ë¦¬ëŠ”ì§€
â†’ ì—ëŸ¬ìœ¨: ì‹¤íŒ¨í•˜ëŠ” ìš”ì²­ì´ ì–¼ë§ˆë‚˜ ë˜ëŠ”ì§€
â†’ Kafka Consumer Lag: ì²˜ë¦¬ ëª»í•œ ë©”ì‹œì§€ê°€ ìŒ“ì´ê³  ìˆëŠ”ì§€
```

### ì–´ë–»ê²Œ êµ¬í˜„í–ˆë‚˜?

```
[ì„œë²„] â”€â”€ë©”íŠ¸ë¦­ ìˆ˜ì§‘â”€â”€â†’ [Prometheus] â”€â”€ì‹œê°í™”â”€â”€â†’ [Grafana ëŒ€ì‹œë³´ë“œ]

Prometheus: ì„œë²„í•œí…Œ "ì§€ê¸ˆ ìƒíƒœ ì–´ë•Œ?" í•˜ê³  ì£¼ê¸°ì ìœ¼ë¡œ ë¬¼ì–´ë³´ëŠ” ì—­í• 
Grafana: Prometheusê°€ ëª¨ì€ ë°ì´í„°ë¥¼ ì˜ˆìœ ê·¸ë˜í”„ë¡œ ë³´ì—¬ì£¼ëŠ” ì—­í• 

ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ 5ê°œ:
1. chat_messages_sent_total: ì „ì†¡ëœ ì±„íŒ… ë©”ì‹œì§€ ìˆ˜
2. chat_messages_consumed_total: Kafka Consumerê°€ ì²˜ë¦¬í•œ ë©”ì‹œì§€ ìˆ˜
3. chat_websocket_sessions: í˜„ì¬ WebSocket ì—°ê²° ìˆ˜
4. chat_rooms_created_total: ìƒì„±ëœ ì±„íŒ…ë°© ìˆ˜
5. chat_message_consume_duration: ë©”ì‹œì§€ ì²˜ë¦¬ ì‹œê°„
```

---

## 19. STEP 15~16: ëŠë¦° ì¿¼ë¦¬ ê³ ì¹˜ê¸° + ìºì‹œ

### í•œ ì¤„ ìš”ì•½

> ì±„íŒ…ë°© ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ë•Œ **ì¿¼ë¦¬ 21ê°œë¥¼ 1ê°œë¡œ ì¤„ì´ê³ **, ìì£¼ ë³´ëŠ” ë°ì´í„°ëŠ” **ê¸°ì–µí•´ë’€ë‹¤ê°€ ë°”ë¡œ ëŒë ¤ì¤ë‹ˆë‹¤**.

### ë¹„ìœ : ì¶œì„ í™•ì¸

```
[Before â€” N+1 ë¬¸ì œ]
ì„ ìƒë‹˜: "1ë°˜ í•™ìƒ ëª…ë‹¨ ì£¼ì„¸ìš”"
êµë¬´ì‹¤: (í•™ìƒ ëª…ë‹¨ì„ ì¤Œ)
ì„ ìƒë‹˜: "1ë²ˆ í•™ìƒ ì •ë³´ ì£¼ì„¸ìš”" â†’ êµë¬´ì‹¤ ë‹¤ë…€ì˜´
ì„ ìƒë‹˜: "2ë²ˆ í•™ìƒ ì •ë³´ ì£¼ì„¸ìš”" â†’ êµë¬´ì‹¤ ë‹¤ë…€ì˜´
ì„ ìƒë‹˜: "3ë²ˆ í•™ìƒ ì •ë³´ ì£¼ì„¸ìš”" â†’ êµë¬´ì‹¤ ë‹¤ë…€ì˜´
...10ë²ˆ ë°˜ë³µ...
â†’ êµë¬´ì‹¤ì„ 11ë²ˆ ì™•ë³µ! (1ë²ˆ ëª…ë‹¨ + 10ë²ˆ ê°œë³„)

[After â€” JPQL í”„ë¡œì ì…˜]
ì„ ìƒë‹˜: "1ë°˜ í•™ìƒ ì´ë¦„, ì¶œì„ ìˆ˜, ê³¼ëª© ìˆ˜ í•œ ë²ˆì— ì£¼ì„¸ìš”"
êµë¬´ì‹¤: (í•„ìš”í•œ ì •ë³´ë§Œ í•œ ì¥ì— ì •ë¦¬í•´ì„œ ì¤Œ)
â†’ êµë¬´ì‹¤ì„ 1ë²ˆë§Œ ì™•ë³µ!
```

```
[ìºì‹œ â€” Redis Cache Aside]
ì„ ìƒë‹˜ì´ ê°™ì€ ë°˜ ëª…ë‹¨ì„ 5ë¶„ ì•ˆì— ë˜ ë¬¼ì–´ë³´ë©´?

ì²« ë²ˆì§¸: êµë¬´ì‹¤(DB)ì— ê°€ì„œ ê°€ì ¸ì˜´ â†’ ì¹ íŒ(Redis)ì— ì ì–´ë‘ 
ë‘ ë²ˆì§¸: ì¹ íŒë§Œ ë³´ë©´ ë¨! êµë¬´ì‹¤ ì•ˆ ê°€ë„ ë¨

5ë¶„ ì§€ë‚˜ë©´? ì¹ íŒ ì§€ìš°ê³  ë‹¤ì‹œ êµë¬´ì‹¤ì—ì„œ ê°€ì ¸ì˜´
ëˆ„ê°€ ì „í•™ ì˜¤ë©´? ì¹ íŒ ì§€ìš°ê³  ë‹¤ì‹œ êµë¬´ì‹¤ì—ì„œ ê°€ì ¸ì˜´ (ìµœì‹  ì •ë³´ ë³´ì¥)
```

### ê²°ê³¼

```
Before: ì±„íŒ…ë°© 10ê°œ â†’ DB ì¿¼ë¦¬ 21ê°œ (1 + 10 + 10)
After:  ì±„íŒ…ë°© 10ê°œ â†’ DB ì¿¼ë¦¬ 1ê°œ (+ ìºì‹œ íˆíŠ¸ ì‹œ 0ê°œ)
```

---

## 20. STEP 17: DB ì¸ë±ìŠ¤

### í•œ ì¤„ ìš”ì•½

> DBì—ì„œ ë°ì´í„°ë¥¼ ì°¾ì„ ë•Œ **ì²˜ìŒë¶€í„° ëê¹Œì§€ í›‘ì§€ ì•Šê³  ë°”ë¡œ ì°¾ì„ ìˆ˜ ìˆë„ë¡** ëª©ì°¨ë¥¼ ë§Œë“­ë‹ˆë‹¤.

### ë¹„ìœ : ë„ì„œê´€ì—ì„œ ì±… ì°¾ê¸°

```
[ì¸ë±ìŠ¤ ì—†ìŒ]
"í•´ë¦¬í¬í„°" ì°¾ìœ¼ë ¤ë©´ â†’ 1ì¸µë¶€í„° ì±…ì¥ í•˜ë‚˜í•˜ë‚˜ ë‹¤ í™•ì¸
â†’ ì±…ì´ 10ë§Œ ê¶Œì´ë©´ 10ë§Œ ë²ˆ í™•ì¸í•´ì•¼ í•  ìˆ˜ë„...

[ì¸ë±ìŠ¤ ìˆìŒ]
ë„ì„œê´€ ê²€ìƒ‰ ì»´í“¨í„°ì— "í•´ë¦¬í¬í„°" ê²€ìƒ‰
â†’ "3ì¸µ A-7 ì±…ì¥, ìœ„ì—ì„œ 3ë²ˆì§¸" â†’ ë°”ë¡œ ì°¾ìŒ!
```

### ì‹¤ì œë¡œ ë§Œë“  ì¸ë±ìŠ¤

```
ì´ 5ê°œ ì¸ë±ìŠ¤ ì„¤ê³„:

1. ë©”ì‹œì§€ ì¡°íšŒìš© (room_id + id): ì±„íŒ…ë°©ì˜ ë©”ì‹œì§€ë¥¼ ìµœì‹ ìˆœìœ¼ë¡œ ë¹ ë¥´ê²Œ ì¡°íšŒ
2. ë©±ë“±ì„± ì²´í¬ìš© (message_key): ê°™ì€ ë©”ì‹œì§€ê°€ ì¤‘ë³µ ì €ì¥ë˜ì§€ ì•Šë„ë¡
3. ë©¤ë²„ í™•ì¸ìš© (room_id + user_id): "ì´ ìœ ì €ê°€ ì´ ë°©ì˜ ë©¤ë²„ì¸ê°€?"
4. ì±„íŒ…ë°© ëª©ë¡ìš© (user_id): "ì´ ìœ ì €ì˜ ì±„íŒ…ë°© ëª©ë¡"
5. ë°œì‹ ì ì¡°íšŒìš© (sender_id): ê´€ë¦¬/ê²€ìƒ‰ ê¸°ëŠ¥ìš©

ëª¨ë“  ì£¼ìš” ì¿¼ë¦¬ê°€ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ EXPLAIN ANALYZEë¡œ í™•ì¸ ì™„ë£Œ
```

---

## 21. STEP 18~19: ë¶€í•˜ í…ŒìŠ¤íŠ¸

### í•œ ì¤„ ìš”ì•½

> **k6**ë¡œ ê°€ì§œ ìœ ì € 200ëª…ì„ ë§Œë“¤ì–´ì„œ ì„œë²„ë¥¼ ë•Œë¦¬ê³ , ìµœì í™” ì „í›„ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.

### ë¹„ìœ : ë†€ì´ê³µì› ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸

```
ë†€ì´ê³µì› ê°œì¥ ì „ì— ì§ì› 200ëª…ì´ ì†ë‹˜ ì—­í• ì„ í•˜ë©° í…ŒìŠ¤íŠ¸:
â†’ ë§¤í‘œì†Œì— 200ëª…ì´ ëª°ë¦¬ë©´ ì¤„ì´ ì–¼ë§ˆë‚˜ ê¸¸ì–´ì§€ëŠ”ì§€?
â†’ ë†€ì´ê¸°êµ¬ë¥¼ í•œ ë²ˆ íƒ€ëŠ” ë° ì–¼ë§ˆë‚˜ ê±¸ë¦¬ëŠ”ì§€?
â†’ ì§ì›ì´ 2ëª…ì´ë©´ 1ëª…ì¼ ë•Œë³´ë‹¤ ì–¼ë§ˆë‚˜ ë¹¨ë¼ì§€ëŠ”ì§€?

ìš°ë¦¬ í”„ë¡œì íŠ¸:
â†’ ê°€ì§œ ìœ ì € 200ëª…ì´ ì±„íŒ…ë°© ëª©ë¡/ìƒì„¸/ë©”ì‹œì§€ ì¡°íšŒë¥¼ ë°˜ë³µ
â†’ ìµœì í™” ì „(N+1)ê³¼ í›„(ë‹¨ì¼ ì¿¼ë¦¬+ìºì‹œ)ë¥¼ ë¹„êµ
```

### ê²°ê³¼ (Before vs After)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ë©”íŠ¸ë¦­      â”‚  Before  â”‚  After   â”‚  ê°œì„     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì´ˆë‹¹ ì²˜ë¦¬ëŸ‰   â”‚  937 RPS â”‚ 1,598 RPSâ”‚  +70%   â”‚
â”‚ ì‘ë‹µì‹œê°„ ì¤‘ì•™ â”‚  54ms    â”‚  16ms    â”‚  -69%   â”‚
â”‚ ì‘ë‹µì‹œê°„ p95  â”‚  212ms   â”‚  149ms   â”‚  -30%   â”‚
â”‚ ì´ ì²˜ë¦¬ëŸ‰     â”‚  67,417  â”‚ 118,900  â”‚  +76%   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

WebSocket: 579 ë™ì‹œ ì„¸ì…˜, 2ëŒ€ ìŠ¤ì¼€ì¼ì•„ì›ƒ ì‹œ 1,158 ì„¸ì…˜ (2ë°°)
```

> ìì„¸í•œ ë¶„ì„ì€ [ì„±ëŠ¥ ìµœì í™” ê¸°ë¡](PERF_RESULT.md)ì„ ì°¸ê³ í•˜ì„¸ìš”.

---

## 22. ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

### Q: ì„œë²„ê°€ 2ëŒ€ì¸ë° ê°™ì€ DBë¥¼ ì“°ë©´ ë¬¸ì œ ì—†ì–´?

```
A: ë¬¸ì œì—†ì–´ìš”!

DB(PostgreSQL)ëŠ” ì›ë˜ ì—¬ëŸ¬ í”„ë¡œê·¸ë¨ì´ ë™ì‹œì— ì ‘ê·¼í•˜ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆì–´ìš”.

ë¹„ìœ : ë„ì„œê´€
â†’ ì‚¬ì„œê°€ 1ëª…ì´ì–´ë„, í•™ìƒ 100ëª…ì´ ë™ì‹œì— ì±…ì„ ë¹Œë¦¬ê³  ë°˜ë‚©í•  ìˆ˜ ìˆìŒ
â†’ ë„ì„œê´€(DB)ì´ ì•Œì•„ì„œ ìˆœì„œë¥¼ ê´€ë¦¬í•´ì¤Œ

ë‹¤ë§Œ, ê°™ì€ ë°ì´í„°ë¥¼ ë™ì‹œì— ìˆ˜ì •í•˜ë©´ ì¶©ëŒ ê°€ëŠ¥:
â†’ ì´ê±¸ í•´ê²°í•˜ëŠ” ê²Œ @Transactional, ë‚™ê´€ì  ë½ ë“±
â†’ ìš°ë¦¬ í”„ë¡œì íŠ¸ì—ì„œëŠ” incrementUnreadCount ê°™ì€ ì›ìì  ì—°ì‚°ìœ¼ë¡œ í•´ê²°
```

### Q: Redisê°€ ì£½ìœ¼ë©´ ì„œë¹„ìŠ¤ë„ ì£½ì–´?

```
A: ì•„ë‹ˆìš”! ëŠë ¤ì§€ì§€ë§Œ ì£½ì§€ëŠ” ì•Šì•„ìš”.

Redisê°€ í•˜ëŠ” ì¼:
1. Pub/Sub (ì„œë²„ ê°„ ë°©ì†¡) â†’ Redis ì—†ìœ¼ë©´ ë‹¤ë¥¸ ì„œë²„ë¡œ ë©”ì‹œì§€ ì „ë‹¬ ë¶ˆê°€
2. ìºì‹œ (ì•ˆì½ì€ ìˆ˜) â†’ Redis ì—†ìœ¼ë©´ ë§¤ë²ˆ DB ì¡°íšŒ (ëŠë¦¬ì§€ë§Œ ë™ì‘)
3. Presence (ì ‘ì† ìƒíƒœ) â†’ Redis ì—†ìœ¼ë©´ ì ‘ì† ìƒíƒœ í‘œì‹œ ë¶ˆê°€

í•µì‹¬ ë°ì´í„°(ë©”ì‹œì§€, ìœ ì €, ì±„íŒ…ë°©)ëŠ” ì „ë¶€ DBì— ìˆìœ¼ë¯€ë¡œ:
â†’ Redisê°€ ì£½ì–´ë„ "ëŠë¦° ì±„íŒ…"ì€ ê°€ëŠ¥
â†’ ë¬¼ë¡  Redisê°€ ì£½ìœ¼ë©´ ë¹¨ë¦¬ ê³ ì³ì•¼ í•¨!
```

### Q: Kafkaê°€ ì£½ìœ¼ë©´?

```
A: ìƒˆ ë©”ì‹œì§€ ì „ì†¡ì´ ì•ˆ ë¼ìš”. í•˜ì§€ë§Œ ê¸°ì¡´ ë°ì´í„°ëŠ” ì•ˆì „í•´ìš”.

Kafkaê°€ ì£½ìœ¼ë©´:
â†’ ìƒˆ ë©”ì‹œì§€ ì „ì†¡: ë¶ˆê°€ (Kafkaê°€ ì¤‘ê°„ ì—­í• ì´ë‹ˆê¹Œ)
â†’ ê¸°ì¡´ ë©”ì‹œì§€ ì¡°íšŒ: ê°€ëŠ¥ (DBì— ì´ë¯¸ ì €ì¥ë˜ì–´ ìˆìœ¼ë‹ˆê¹Œ)
â†’ ì½ìŒ ì²˜ë¦¬: ë¶ˆê°€ (Kafkaë¥¼ ê±°ì³ì„œ ì²˜ë¦¬í•˜ë‹ˆê¹Œ)

ê²°ë¡ : KafkaëŠ” ë§¤ìš° ì¤‘ìš”í•œ ì¸í”„ë¼
â†’ í”„ë¡œë•ì…˜ì—ì„œëŠ” Kafka í´ëŸ¬ìŠ¤í„°(ì—¬ëŸ¬ ëŒ€)ë¡œ ìš´ì˜
â†’ 1ëŒ€ê°€ ì£½ì–´ë„ ë‹¤ë¥¸ ëŒ€ê°€ ì²˜ë¦¬
```

### Q: @Setterë¥¼ ì•ˆ ì“°ëŠ” ì´ìœ ?

```java
// @Setterë¥¼ ì“°ë©´ (ë‚˜ìœ ì˜ˆ):
user.setPassword("1234");       // ì•”í˜¸í™” ì•ˆ ëœ ë¹„ë°€ë²ˆí˜¸ê°€ ê·¸ëŒ€ë¡œ ì €ì¥ë  ìˆ˜ ìˆìŒ!
user.setStatus(null);           // nullë¡œ ì„¤ì • ê°€ëŠ¥... ì˜ë„í•œ ê±´ê°€?
user.setCreatedAt(someDate);    // ìƒì„± ì‹œê°ì„ ë§ˆìŒëŒ€ë¡œ ë°”ê¿€ ìˆ˜ ìˆìŒ!

// @Setter ì—†ì´ ì˜ë¯¸ ìˆëŠ” ë©”ì„œë“œë§Œ ì œê³µ (ì¢‹ì€ ì˜ˆ):
user.updateStatus(UserStatus.ONLINE);   // "ìƒíƒœë¥¼ ì˜¨ë¼ì¸ìœ¼ë¡œ ë°”ê¾¸ê¸°"
user.updateLastSeenAt();                 // "ë§ˆì§€ë§‰ ì ‘ì† ì‹œê° ê°±ì‹ "
// â†’ ì–´ë–¤ ë³€ê²½ì´ ê°€ëŠ¥í•œì§€ ëª…í™•í•˜ê³ , ì˜ëª»ëœ ë³€ê²½ì€ ë¶ˆê°€ëŠ¥!

ë¹„ìœ : ìíŒê¸° vs ê³µê°œ ëƒ‰ì¥ê³ 
@Setter: ëƒ‰ì¥ê³  ë¬¸ì„ ì—´ì–´ë‘  â†’ ì•„ë¬´ ìŒë£Œë‚˜ ë„£ê³  ë¹¼ê³  ê°€ëŠ¥ (ìœ„í—˜!)
ë©”ì„œë“œ: ìíŒê¸° â†’ "ì½œë¼ ë²„íŠ¼", "ì‚¬ì´ë‹¤ ë²„íŠ¼"ë§Œ ìˆìŒ (ì•ˆì „!)
```

### Q: ì™œ Kafka Consumerê°€ 2ê°œ ê·¸ë£¹ì´ì•¼? 1ê°œë¡œ í•˜ë©´ ì•ˆ ë¼?

```
1ê°œ Consumerë¡œ "DB ì €ì¥ + ë°©ì†¡"ì„ ê°™ì´ í•˜ë©´?

ë¬¸ì œ 1: DB ì €ì¥ì´ ëŠë ¤ì§€ë©´ ë°©ì†¡ë„ ëŠë ¤ì§
â†’ 1ê°œê°€ ëª¨ë“  ì¼ì„ í•˜ë‹ˆê¹Œ, í•˜ë‚˜ê°€ ë°€ë¦¬ë©´ ì „ë¶€ ë°€ë¦¼

ë¬¸ì œ 2: ë°©ì†¡ ì—ëŸ¬ê°€ ë‚˜ë©´ DB ì €ì¥ë„ ì‹¤íŒ¨?
â†’ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì—ì„œ ì²˜ë¦¬í•˜ë©´ ê·¸ëŸ´ ìˆ˜ ìˆìŒ

2ê°œ Consumer Groupìœ¼ë¡œ ë¶„ë¦¬í•˜ë©´:
â†’ DB ì €ì¥ì´ ëŠë ¤ë„ ë°©ì†¡ì€ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘
â†’ ë°©ì†¡ ì—ëŸ¬ê°€ ë‚˜ë„ DB ì €ì¥ì€ ì •ìƒ ì§„í–‰
â†’ ê°ê° ë…ë¦½ì ìœ¼ë¡œ ìŠ¤ì¼€ì¼ ì¡°ì ˆ ê°€ëŠ¥

ë¹„ìœ : íšŒì‚¬ì—ì„œ ì˜ì—…íŒ€ê³¼ ë¬¼ë¥˜íŒ€ì„ ë¶„ë¦¬í•˜ëŠ” ê²ƒ
â†’ ì˜ì—…ì´ ë°”ë¹ ë„ ë¬¼ë¥˜ëŠ” ìê¸° ì†ë„ë¡œ ì¼í•¨
â†’ ë¬¼ë¥˜ì— ë¬¸ì œê°€ ìƒê²¨ë„ ì˜ì—…ì€ ê³„ì† ì£¼ë¬¸ì„ ë°›ìŒ
```

### Q: ì´ í”„ë¡œì íŠ¸ ì½”ë“œë¥¼ ì½ëŠ” ìˆœì„œ?

```
ì¶”ì²œ ìˆœì„œ:

1ë‹¨ê³„: "ì–´ë–»ê²Œ ìƒê²¼ëŠ”ì§€" ê° ì¡ê¸°
â†’ CLAUDE.md (í”„ë¡œì íŠ¸ ê°œìš”)
â†’ ì´ í•™ìŠµ ê°€ì´ë“œ (ì „ì²´ ê·¸ë¦¼)

2ë‹¨ê³„: "ë°ì´í„°ê°€ ì–´ë–»ê²Œ ìƒê²¼ëŠ”ì§€" ì´í•´
â†’ domain/ í´ë” (User, ChatRoom, Message ë“±)
â†’ schema.sql (í…Œì´ë¸” êµ¬ì¡°)

3ë‹¨ê³„: "APIê°€ ë­ê°€ ìˆëŠ”ì§€" í™•ì¸
â†’ controller/ í´ë” (ì–´ë–¤ ìš”ì²­ì„ ë°›ëŠ”ì§€)
â†’ dto/ í´ë” (ìš”ì²­/ì‘ë‹µ í˜•ì‹)

4ë‹¨ê³„: "ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§" ì´í•´
â†’ service/ í´ë” (ì‹¤ì œë¡œ ë¬´ìŠ¨ ì¼ì„ í•˜ëŠ”ì§€)

5ë‹¨ê³„: "ë©”ì‹œì§€ íë¦„" ë”°ë¼ê°€ê¸°
â†’ producer/ â†’ consumer/ â†’ RedisPubSubService
â†’ ì´ ê°€ì´ë“œì˜ "ë©”ì‹œì§€ ì—¬í–‰ê¸°" ì„¹ì…˜ ì°¸ê³ 

6ë‹¨ê³„: "ì„¤ì •" ì´í•´
â†’ config/ í´ë” (Kafka, Redis, WebSocket, Security ì„¤ì •)

7ë‹¨ê³„: "í…ŒìŠ¤íŠ¸" ì‹¤í–‰
â†’ test/ í´ë” (./gradlew testë¡œ ì‹¤í–‰í•´ë³´ê¸°)
```

---

> ì´ ê°€ì´ë“œë¥¼ ì²˜ìŒë¶€í„° ëê¹Œì§€ ì½ì—ˆë‹¤ë©´, ì´ í”„ë¡œì íŠ¸ì˜ **ëª¨ë“  ì½”ë“œê°€ ì™œ ê±°ê¸°ì— ìˆëŠ”ì§€** ì´í•´í•  ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤.
> ì´í•´ê°€ ì•ˆ ë˜ëŠ” ë¶€ë¶„ì´ ìˆë‹¤ë©´ **í•´ë‹¹ íŒŒì¼ì„ ì§ì ‘ ì—´ì–´ë³´ë©´ì„œ** ì´ ê°€ì´ë“œì˜ ì„¤ëª…ê³¼ ë¹„êµí•´ë³´ì„¸ìš”!
> ì½”ë“œë¥¼ ì½ëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ **ì‹¤ì œë¡œ ì‹¤í–‰í•´ë³´ë©´ì„œ** ë™ì‘ì„ í™•ì¸í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
>
> ```bash
> docker compose up -d    # ì¸í”„ë¼ ì‹¤í–‰
> ./gradlew bootRun       # ì•± ì‹¤í–‰
> ./gradlew test          # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
> ```
